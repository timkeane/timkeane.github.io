import{I as e,f as t,g as r,h as n,k as i,l as o,m as a,n as s,r as l,p as u,q as c,s as p,L as h,u as d,v as f,w as m,x as g,y,z as x,A as v,B as b,E as w,H as T,J as _,K as S,N as k,Q as z,S as C,U as E,X as R,Y as I,Z as j,_ as F,a as M,e as P,$ as A,a0 as L,a1 as O,a2 as D,a3 as q,a4 as $,a5 as G,a6 as N,a7 as U,a8 as V,a9 as W,aa as X,ab as J,ac as Z,ad as K,ae as H,af as B,ag as Y,ah as Q,ai as ee,aj as te,ak as re,al as ne,am as ie,an as oe,ao as ae,ap as se,aq as le,ar as ue,as as ce,at as pe,au as he,av as de,aw as fe,ax as me,ay as ge,az as ye,aA as xe,aB as ve,aC as be,aD as we,c as Te,aE as _e,aF as Se,aG as ke,aH as ze,aI as Ce,aJ as Ee,aK as Re,aL as Ie,aM as je,aN as Fe,aO as Me,aP as Pe,aQ as Ae,aR as Le,aS as Oe,aT as De,aU as qe,aV as $e,aW as Ge,aX as Ne,aY as Ue,aZ as Ve,a_ as We,a$ as Xe,M as Je,b0 as Ze,b1 as Ke,b2 as He,b3 as Be,b4 as Ye,b5 as Qe,G as et,V as tt,b as rt,b6 as nt,b7 as it,b8 as ot,b9 as at}from"./vendor-cBnjCObF.js";const st=class extends e{constructor(e,r,n,i,o){super(e,r,n,void 0!==o?t.IDLE:t.LOADED),this.loader_=void 0!==o?o:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=t.ERROR):this.state=t.LOADED,this.changed()}load(){this.state==t.IDLE&&(this.state=t.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}};const lt=class extends r{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache();){if(this.peekLast().getKey()in e)break;this.pop().release()}}pruneExceptNewestZ(){if(0===this.getCount())return;const e=this.peekFirstKey(),t=n(e)[0];this.forEach((e=>{e.tileCoord[0]!==t&&(this.remove(i(e.tileCoord)),e.release())}))}},ut=[];const ct=class extends o{constructor(e,t,r,n){super(e,t,{transition:0}),this.context_={},this.executorGroups={},this.declutterExecutorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=n.bind(void 0,this),this.wrappedTileCoord=r}getContext(e){const t=a(e);return t in this.context_||(this.context_[t]=s(1,1,ut)),this.context_[t]}hasContext(e){return a(e)in this.context_}getImage(e){return this.hasContext(e)?this.getContext(e).canvas:null}getReplayState(e){const t=a(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[t]}load(){this.getSourceTiles()}release(){for(const e in this.context_){const t=this.context_[e];l(t),ut.push(t.canvas),delete this.context_[e]}super.release()}};const pt=class extends o{constructor(e,t,r,n,i,o){super(e,t,o),this.extent=null,this.format_=n,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=i,this.url_=r,this.key=r}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==u.IDLE&&(this.setState(u.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,t){this.setFeatures(e)}onError(){this.setState(u.ERROR)}setFeatures(e){this.features_=e,this.setState(u.LOADED)}setLoader(e){this.loader_=e}};function ht(e,t){const r=/\{z\}/g,n=/\{x\}/g,i=/\{y\}/g,o=/\{-y\}/g;return function(a,s,l){if(a)return e.replace(r,a[0].toString()).replace(n,a[1].toString()).replace(i,a[2].toString()).replace(o,(function(){const e=a[0],r=t.getFullTileRange(e);if(!r)throw new Error("The {-y} placeholder requires a tile grid with extent");return(r.getHeight()-a[2]-1).toString()}))}}function dt(e,t){const r=e.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=ht(e[i],t);return function(e){if(1===e.length)return e[0];return function(t,r,n){if(!t)return;const i=c(t),o=p(i,e.length);return e[o](t,r,n)}}(n)}function ft(e){const t=[];let r=/\{([a-z])-([a-z])\}/.exec(e);if(r){const n=r[1].charCodeAt(0),i=r[2].charCodeAt(0);let o;for(o=n;o<=i;++o)t.push(e.replace(r[0],String.fromCharCode(o)));return t}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){const n=parseInt(r[2],10);for(let i=parseInt(r[1],10);i<=n;i++)t.push(e.replace(r[0],i.toString()));return t}return t.push(e),t}const mt=class extends h{constructor(e){super(e=e||{})}};const gt=class extends d{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const r=e.layerStatesArray[e.layerIndex],n=e.pixelRatio,i=e.viewState,o=i.resolution,a=this.getLayer().getSource(),s=e.viewHints;let l=e.extent;if(void 0!==r.extent&&(l=f(l,m(r.extent,i.projection))),!s[g.ANIMATING]&&!s[g.INTERACTING]&&!y(l))if(a){const e=i.projection,r=a.getImage(l,o,n,e);r&&(this.loadImage(r)?this.image_=r:r.getState()===t.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),n=x(t.pixelToCoordinateTransform,e.slice()),i=r.getExtent();if(i&&!v(i,n))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),s=b(o),l=Math.floor(a.width*((n[0]-o[0])/s));if(l<0||l>=a.width)return null;const u=w(o),c=Math.floor(a.height*((o[3]-n[1])/u));return c<0||c>=a.height?null:this.getImageData(a,l,c)}renderFrame(e,t){const r=this.image_,n=r.getExtent(),i=r.getResolution(),[o,a]=Array.isArray(i)?i:[i,i],s=r.getPixelRatio(),l=e.layerStatesArray[e.layerIndex],u=e.pixelRatio,c=e.viewState,p=c.center,h=c.resolution,d=u*o/(h*s),f=u*a/(h*s),g=e.extent,y=c.resolution,x=c.rotation,v=Math.round(b(g)/y*u),C=Math.round(w(g)/y*u);T(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/u,1/u,x,-v/2,-C/2),_(this.inversePixelTransform,this.pixelTransform);const E=S(this.pixelTransform);this.useContainer(t,E,this.getBackground(e));const R=this.context,I=R.canvas;I.width!=v||I.height!=C?(I.width=v,I.height=C):this.containerReused||R.clearRect(0,0,v,C);let j=!1,F=!0;if(l.extent){const t=m(l.extent,c.projection);F=k(t,e.extent),j=F&&!z(t,e.extent),j&&this.clipUnrotated(R,e,t)}const M=r.getImage(),P=T(this.tempTransform,v/2,C/2,d,f,0,s*(n[0]-p[0])/o,s*(p[1]-n[3])/a);this.renderedResolution=a*u/s;const A=M.width*P[0],L=M.height*P[3];if(this.getLayer().getSource().getInterpolate()||(R.imageSmoothingEnabled=!1),this.preRender(R,e),F&&A>=.5&&L>=.5){const e=P[4],t=P[5],r=l.opacity;let n;1!==r&&(n=R.globalAlpha,R.globalAlpha=r),R.drawImage(M,0,0,+M.width,+M.height,e,t,A,L),1!==r&&(R.globalAlpha=n)}return this.postRender(R,e),j&&R.restore(),R.imageSmoothingEnabled=!0,E!==I.style.transform&&(I.style.transform=E),this.container}};const yt=class extends mt{constructor(e){super(e)}createRenderer(){return new gt(this)}getData(e){return super.getData(e)}};function xt(e,t,r){if(3===e){const e={keys:[],values:[],features:[]},n=r.readVarint()+r.pos;r.readFields(vt,e,n),e.length=e.features.length,e.length&&(t[e.name]=e)}}function vt(e,t,r){if(15===e)t.version=r.readVarint();else if(1===e)t.name=r.readString();else if(5===e)t.extent=r.readVarint();else if(2===e)t.features.push(r.pos);else if(3===e)t.keys.push(r.readString());else if(4===e){let n=null;const i=r.readVarint()+r.pos;for(;r.pos<i;)n=1===(e=r.readVarint()>>3)?r.readString():2===e?r.readFloat():3===e?r.readDouble():4===e?r.readVarint64():5===e?r.readVarint():6===e?r.readSVarint():7===e?r.readBoolean():null;t.values.push(n)}}function bt(e,t,r){if(1==e)t.id=r.readVarint();else if(2==e){const e=r.readVarint()+r.pos;for(;r.pos<e;){const e=t.layer.keys[r.readVarint()],n=t.layer.values[r.readVarint()];t.properties[e]=n}}else 3==e?t.type=r.readVarint():4==e&&(t.geometry=r.pos)}function wt(e,t,r){e.pos=t.features[r];const n=e.readVarint()+e.pos,i={layer:t,type:0,properties:{}};return e.readFields(bt,i,n),i}const Tt=class extends C{constructor(e){super(),e=e||{},this.dataProjection=new E({code:"",units:"tile-pixels"}),this.featureClass_=e.featureClass?e.featureClass:R,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,t,r,n){e.pos=t.geometry;const i=e.readVarint()+e.pos;let o=1,a=0,s=0,l=0,u=0,c=0;for(;e.pos<i;){if(!a){const t=e.readVarint();o=7&t,a=t>>3}if(a--,1===o||2===o)s+=e.readSVarint(),l+=e.readSVarint(),1===o&&u>c&&(n.push(u),c=u),r.push(s,l),u+=2;else{if(7!==o)throw new Error("Invalid command found in the PBF");u>c&&(r.push(r[c],r[c+1]),u+=2)}}u>c&&(n.push(u),c=u)}createFeature_(e,t,r){const n=t.type;if(0===n)return null;let i;const o=t.properties;let a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=t.id,o[this.layerName_]=t.layer.name;const s=[],l=[];this.readRawGeometry_(e,t,s,l);const u=function(e,t){let r;1===e?r=1===t?"Point":"MultiPoint":2===e?r=1===t?"LineString":"MultiLineString":3===e&&(r="Polygon");return r}(n,l.length);if(this.featureClass_===R)i=new this.featureClass_(u,s,l,2,o,a),i.transform(r.dataProjection);else{let e;if("Polygon"==u){const t=I(s,l);e=t.length>1?new j(s,"XY",t):new F(s,"XY",l)}else e="Point"===u?new M(s,"XY"):"LineString"===u?new P(s,"XY"):"MultiPoint"===u?new A(s,"XY"):"MultiLineString"===u?new L(s,"XY",l):null;i=new(0,this.featureClass_),this.geometryName_&&i.setGeometryName(this.geometryName_);const t=O(e,!1,r);i.setGeometry(t),void 0!==a&&i.setId(a),i.setProperties(o,!0)}return i}getType(){return"arraybuffer"}readFeatures(e,t){const r=this.layers_;t=this.adaptOptions(t);const n=D(t.dataProjection);n.setWorldExtent(t.extent),t.dataProjection=n;const i=new q(e),o=i.readFields(xt,{}),a=[];for(const s in o){if(r&&!r.includes(s))continue;const e=o[s],l=e?[0,0,e.extent,e.extent]:null;n.setExtent(l);for(let r=0,n=e.length;r<n;++r){const n=wt(i,e,r),o=this.createFeature_(i,n,t);null!==o&&a.push(o)}}return a}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}};function _t(e){return Array.isArray(e)?Math.min(...e):e}const St=class extends e{constructor(e,r,n,i,o,a,s){let l=e.getExtent();l&&e.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let u=r.getExtent();u&&r.canWrapX()&&(u=u.slice(),u[0]=-1/0,u[2]=1/0);const c=u?f(n,u):n,p=$(c),h=G(e,r,p,i),d=new N(e,r,c,l,h*J,i),m=d.calculateSourceExtent(),g=y(m)?null:a(m,h,o),x=g?t.IDLE:t.EMPTY,v=g?g.getPixelRatio():1;super(n,i,v,x),this.targetProj_=r,this.maxSourceExtent_=l,this.triangulation_=d,this.targetResolution_=i,this.targetExtent_=n,this.sourceImage_=g,this.sourcePixelRatio_=v,this.interpolate_=s,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==t.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==t.LOADED){const e=b(this.targetExtent_)/this.targetResolution_,t=w(this.targetExtent_)/this.targetResolution_;this.canvas_=U(e,t,this.sourcePixelRatio_,_t(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==t.IDLE){this.state=t.LOADING,this.changed();const e=this.sourceImage_.getState();e==t.LOADED||e==t.ERROR?this.reproject_():(this.sourceListenerKey_=V(this.sourceImage_,W.CHANGE,(function(e){const r=this.sourceImage_.getState();r!=t.LOADED&&r!=t.ERROR||(this.unlistenSource_(),this.reproject_())}),this),this.sourceImage_.load())}}unlistenSource_(){X(this.sourceListenerKey_),this.sourceListenerKey_=null}},kt="imageloadstart",zt="imageloadend",Ct="imageloaderror";class Et extends ee{constructor(e,t){super(e),this.image=t}}const Rt=class extends Z{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:void 0===e.interpolate||e.interpolate}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=void 0!==e.resolutions?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=!!e.loader&&0===e.loader.length,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){e=t[K(t,e,0)]}return e}getImage(e,t,r,n){const i=this.getProjection();if(!i||!n||H(i,n))return i&&(n=i),this.getImageInternal(e,t,r,n);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&H(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==t&&B(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new St(i,n,e,t,r,((e,t,r)=>this.getImageInternal(e,t,r,i)),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(t,r,n,i){if(this.loader){const o=function(e,t,r,n){const i=t/r,o=$(e),a=Y(b(e)/i,4),s=Y(w(e)/i,4),l=Y((n-1)*a/2,4),u=a+2*l,c=Y((n-1)*s/2,4);return Q(o,i,0,[u,s+2*c])}(t,r,n,1),a=this.findNearestResolution(r);if(this.image&&(this.static_||this.wantedProjection_===i&&(this.wantedExtent_&&z(this.wantedExtent_,o)||z(this.image.getExtent(),o))&&(this.wantedResolution_&&_t(this.wantedResolution_)===a||_t(this.image.getResolution())===a)))return this.image;this.wantedProjection_=i,this.wantedExtent_=o,this.wantedResolution_=a,this.image=new e(o,a,n,this.loader),this.image.addEventListener(W.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const r=e.target;let n;switch(r.getState()){case t.LOADING:this.loading=!0,n=kt;break;case t.LOADED:this.loading=!1,n=zt;break;case t.ERROR:this.loading=!1,n=Ct;break;default:return}this.hasListener(n)&&this.dispatchEvent(new Et(n,r))}},It="preload",jt="useInterimTilesOnError";const Ft=class extends h{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(void 0!==e.preload?e.preload:0),this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError)}getPreload(){return this.get(It)}setPreload(e){this.set(It,e)}getUseInterimTilesOnError(){return this.get(jt)}setUseInterimTilesOnError(e){this.set(jt,e)}getData(e){return super.getData(e)}};const Mt=class extends d{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=te(),this.tmpTileRange_=new re(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),r=e.getState(),n=t.getUseInterimTilesOnError();return r==u.LOADED||r==u.EMPTY||r==u.ERROR&&!n}getTile(e,t,r,n){const i=n.pixelRatio,o=n.viewState.projection,a=this.getLayer();let s=a.getSource().getTile(e,t,r,i,o);return s.getState()==u.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(s)||(s=s.getInterimTile()),s}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),n=x(t.pixelToCoordinateTransform,e.slice()),i=r.getExtent();if(i&&!v(i,n))return null;const o=t.pixelRatio,a=t.viewState.projection,s=t.viewState,l=r.getRenderSource(),c=l.getTileGridForProjection(s.projection),p=l.getTilePixelRatio(t.pixelRatio);for(let h=c.getZForResolution(s.resolution);h>=c.getMinZoom();--h){const e=c.getTileCoordForCoordAndZ(n,h),t=l.getTile(h,e[1],e[2],o,a);if(!(t instanceof ne||t instanceof ie)||t instanceof ie&&t.getState()===u.EMPTY)return null;if(t.getState()!==u.LOADED)continue;const r=c.getOrigin(h),i=oe(c.getTileSize(h)),d=c.getResolution(h),f=Math.floor(p*((n[0]-r[0])/d-e[1]*i[0])),m=Math.floor(p*((r[1]-n[1])/d-e[2]*i[1])),g=Math.round(p*l.getGutterForProjection(s.projection));return this.getImageData(t.getImage(),f+g,m+g)}return null}loadedTileCallback(e,t,r){return!!this.isDrawableTile(r)&&super.loadedTileCallback(e,t,r)}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const r=e.layerStatesArray[e.layerIndex],n=e.viewState,i=n.projection,o=n.resolution,s=n.center,l=n.rotation,c=e.pixelRatio,p=this.getLayer(),h=p.getSource(),d=h.getRevision(),g=h.getTileGridForProjection(i),y=g.getZForResolution(o,h.zDirection),v=g.getResolution(y);let z=e.extent;const C=e.viewState.resolution,E=h.getTilePixelRatio(c),R=Math.round(b(z)/C*c),I=Math.round(w(z)/C*c),j=r.extent&&m(r.extent);j&&(z=f(z,m(r.extent)));const F=v*R/2/E,M=v*I/2/E,P=[s[0]-F,s[1]-M,s[0]+F,s[1]+M],A=g.getTileRangeForExtentAndZ(z,y),L={};L[y]={};const O=this.createLoadedTileFinder(h,i,L),D=this.tmpExtent,q=this.tmpTileRange_;this.newTiles_=!1;const $=l?ae(n.center,C,l,e.size):void 0;for(let f=A.minX;f<=A.maxX;++f)for(let t=A.minY;t<=A.maxY;++t){if(l&&!g.tileCoordIntersectsViewport([y,f,t],$))continue;const n=this.getTile(y,f,t,e);if(this.isDrawableTile(n)){const t=a(this);if(n.getState()==u.LOADED){L[y][n.tileCoord.toString()]=n;let e=n.inTransition(t);e&&1!==r.opacity&&(n.endTransition(t),e=!1),this.newTiles_||!e&&this.renderedTiles.includes(n)||(this.newTiles_=!0)}if(1===n.getAlpha(t,e.time))continue}const i=g.getTileCoordChildTileRange(n.tileCoord,q,D);let o=!1;i&&(o=O(y+1,i)),o||g.forEachTileCoordParentTileRange(n.tileCoord,O,q,D)}const G=v/o*c/E;T(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/c,1/c,l,-R/2,-I/2);const N=S(this.pixelTransform);this.useContainer(t,N,this.getBackground(e));const U=this.context,V=U.canvas;_(this.inversePixelTransform,this.pixelTransform),T(this.tempTransform,R/2,I/2,G,G,0,-R/2,-I/2),V.width!=R||V.height!=I?(V.width=R,V.height=I):this.containerReused||U.clearRect(0,0,R,I),j&&this.clipUnrotated(U,e,j),h.getInterpolate()||(U.imageSmoothingEnabled=!1),this.preRender(U,e),this.renderedTiles.length=0;let W,X,J,Z=Object.keys(L).map(Number);Z.sort(se),1!==r.opacity||this.containerReused&&!h.getOpaque(e.viewState.projection)?(W=[],X=[]):Z=Z.reverse();for(let u=Z.length-1;u>=0;--u){const t=Z[u],r=h.getTilePixelSize(t,c,i),n=g.getResolution(t)/v,o=r[0]*n*G,s=r[1]*n*G,l=g.getTileCoordForCoordAndZ(le(P),t),p=g.getTileCoordExtent(l),d=x(this.tempTransform,[E*(p[0]-P[0])/v,E*(P[3]-p[3])/v]),f=E*h.getGutterForProjection(i),m=L[t];for(const i in m){const r=m[i],n=r.tileCoord,u=l[1]-n[1],c=Math.round(d[0]-(u-1)*o),p=l[2]-n[2],g=Math.round(d[1]-(p-1)*s),x=Math.round(d[0]-u*o),v=Math.round(d[1]-p*s),b=c-x,w=g-v,T=y===t,_=T&&1!==r.getAlpha(a(this),e.time);let S=!1;if(!_)if(W){J=[x,v,x+b,v,x+b,v+w,x,v+w];for(let e=0,r=W.length;e<r;++e)if(y!==t&&t<X[e]){const t=W[e];k([x,v,x+b,v+w],[t[0],t[3],t[4],t[7]])&&(S||(U.save(),S=!0),U.beginPath(),U.moveTo(J[0],J[1]),U.lineTo(J[2],J[3]),U.lineTo(J[4],J[5]),U.lineTo(J[6],J[7]),U.moveTo(t[6],t[7]),U.lineTo(t[4],t[5]),U.lineTo(t[2],t[3]),U.lineTo(t[0],t[1]),U.clip())}W.push(J),X.push(t)}else U.clearRect(x,v,b,w);this.drawTileImage(r,e,x,v,b,w,f,T),W&&!_?(S&&U.restore(),this.renderedTiles.unshift(r)):this.renderedTiles.push(r),this.updateUsedTiles(e.usedTiles,h,r)}}return this.renderedRevision=d,this.renderedResolution=v,this.extentChanged=!this.renderedExtent_||!B(this.renderedExtent_,P),this.renderedExtent_=P,this.renderedPixelRatio=c,this.renderedProjection=i,this.manageTilePyramid(e,h,g,c,i,z,y,p.getPreload()),this.scheduleExpireCache(e,h),this.postRender(U,e),r.extent&&U.restore(),U.imageSmoothingEnabled=!0,N!==V.style.transform&&(V.style.transform=N),this.container}drawTileImage(e,t,r,n,i,o,s,l){const u=this.getTileImage(e);if(!u)return;const c=a(this),p=t.layerStatesArray[t.layerIndex],h=p.opacity*(l?e.getAlpha(c,t.time):1),d=h!==this.context.globalAlpha;d&&(this.context.save(),this.context.globalAlpha=h),this.context.drawImage(u,s,s,u.width-2*s,u.height-2*s,r,n,i,o),d&&this.context.restore(),h!==p.opacity?t.animate=!0:l&&e.endTransition(c)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const r=function(e,t,r){const n=a(e);n in r.usedTiles&&e.expireCache(r.viewState.projection,r.usedTiles[n])}.bind(null,t);e.postRenderFunctions.push(r)}}updateUsedTiles(e,t,r){const n=a(t);n in e||(e[n]={}),e[n][r.getKey()]=!0}manageTilePyramid(e,t,r,n,i,o,s,l,c){const p=a(t);p in e.wantedTiles||(e.wantedTiles[p]={});const h=e.wantedTiles[p],d=e.tileQueue,f=r.getMinZoom(),m=e.viewState.rotation,g=m?ae(e.viewState.center,e.viewState.resolution,m,e.size):void 0;let y,x,v,b,w,T,_=0;for(T=f;T<=s;++T)for(x=r.getTileRangeForExtentAndZ(o,T,x),v=r.getResolution(T),b=x.minX;b<=x.maxX;++b)for(w=x.minY;w<=x.maxY;++w)m&&!r.tileCoordIntersectsViewport([T,b,w],g)||(s-T<=l?(++_,y=t.getTile(T,b,w,n,i),y.getState()==u.IDLE&&(h[y.getKey()]=!0,d.isKeyQueued(y.getKey())||d.enqueue([y,p,r.getTileCoordCenter(y.tileCoord),v])),void 0!==c&&c(y)):t.useTile(T,b,w,i));t.updateCacheSize(_,i)}};const Pt=class extends Ft{constructor(e){super(e)}createRenderer(){return new Mt(this)}};class At extends ee{constructor(e,t){super(e),this.tile=t}}const Lt=class extends Z{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=void 0!==e.opaque&&e.opaque,this.tilePixelRatio_=void 0!==e.tilePixelRatio?e.tilePixelRatio:1,this.tileGrid=void 0!==e.tileGrid?e.tileGrid:null;const t=[256,256];this.tileGrid&&oe(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new lt(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const r=this.getTileCacheForProjection(e);r&&r.expireCache(t)}forEachLoadedTile(e,t,r,n){const i=this.getTileCacheForProjection(e);if(!i)return!1;let o,a,s,l=!0;for(let c=r.minX;c<=r.maxX;++c)for(let e=r.minY;e<=r.maxY;++e)a=me(t,c,e),s=!1,i.containsKey(a)&&(o=i.get(a),s=o.getState()===u.LOADED,s&&(s=!1!==n(o))),s||(l=!1);return l}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,r,n,i){return ue()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:ce(e)}getTileCacheForProjection(e){const t=this.getProjection();return pe(null===t||H(t,e),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,r){const n=this.getTileGridForProjection(r),i=this.getTilePixelRatio(t),o=oe(n.getTileSize(e),this.tmpSize);return 1==i?o:he(o,i,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=void 0!==t?t:this.getProjection();const r=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=de(r,e,t)),fe(e,r)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const r=this.getTileCacheForProjection(t);e>r.highWaterMark&&(r.highWaterMark=e)}useTile(e,t,r,n){}};let Ot,Dt=!0;try{new ImageData(10,10)}catch(ms){Dt=!1}function qt(e){let t=!0;try{new ImageData(10,10)}catch(ms){t=!1}function r(e,r,n){return t?new ImageData(e,r,n):{data:e,width:r,height:n}}return function(t){const n=t.buffers,i=t.meta,o=t.imageOps,a=t.width,s=t.height,l=n.length,u=n[0].byteLength;if(o){const t=new Array(l);for(let e=0;e<l;++e)t[e]=r(new Uint8ClampedArray(n[e]),a,s);return e(t,i).data.buffer}const c=new Uint8ClampedArray(u),p=new Array(l),h=new Array(l);for(let e=0;e<l;++e)p[e]=new Uint8ClampedArray(n[e]),h[e]=[0,0,0,0];for(let r=0;r<u;r+=4){for(let e=0;e<l;++e){const t=p[e];h[e][0]=t[r],h[e][1]=t[r+1],h[e][2]=t[r+2],h[e][3]=t[r+3]}const t=e(h,i);c[r]=t[0],c[r+1]=t[1],c[r+2]=t[2],c[r+3]=t[3]}return c.buffer}}function $t(e,t){const r=Object.keys(e.lib||{}).map((function(t){return"const "+t+" = "+e.lib[t].toString()+";"})).concat(["const __minion__ = ("+qt.toString()+")(",e.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),n=new Worker("undefined"==typeof Blob?"data:text/javascript;base64,"+Buffer.from(r.join("\n"),"binary").toString("base64"):URL.createObjectURL(new Blob(r,{type:"text/javascript"})));return n.addEventListener("message",t),n}class Gt extends xe{constructor(e){let t;super(),this._imageOps=!!e.imageOps,t=0===e.threads?0:this._imageOps?1:e.threads||1;const r=new Array(t);if(t)for(let n=0;n<t;++n)r[n]=$t(e,this._onWorkerMessage.bind(this,n));else r[0]=function(e,t){const r=qt(e.operation);let n=!1;return{postMessage:function(e){setTimeout((function(){n||t({data:{buffer:r(e),meta:e.meta}})}),0)},terminate:function(){n=!0}}}(e,this._onWorkerMessage.bind(this,0));this._workers=r,this._queue=[],this._maxQueueLength=e.queue||1/0,this._running=0,this._dataLookup={},this._job=null}process(e,t,r){this._enqueue({inputs:e,meta:t,callback:r}),this._dispatch()}_enqueue(e){for(this._queue.push(e);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)}_dispatch(){if(this._running||0===this._queue.length)return;const e=this._queue.shift();this._job=e;const t=e.inputs[0].width,r=e.inputs[0].height,n=e.inputs.map((function(e){return e.data.buffer})),i=this._workers.length;if(this._running=i,1===i)return void this._workers[0].postMessage({buffers:n,meta:e.meta,imageOps:this._imageOps,width:t,height:r},n);const o=e.inputs[0].data.length,a=4*Math.ceil(o/4/i);for(let s=0;s<i;++s){const i=s*a,o=[];for(let e=0,t=n.length;e<t;++e)o.push(n[e].slice(i,i+a));this._workers[s].postMessage({buffers:o,meta:e.meta,imageOps:this._imageOps,width:t,height:r},o)}}_onWorkerMessage(e,t){this.disposed||(this._dataLookup[e]=t.data,--this._running,0===this._running&&this._resolveJob())}_resolveJob(){const e=this._job,t=this._workers.length;let r,n;if(1===t)r=new Uint8ClampedArray(this._dataLookup[0].buffer),n=this._dataLookup[0].meta;else{const i=e.inputs[0].data.length;r=new Uint8ClampedArray(i),n=new Array(t);const o=4*Math.ceil(i/4/t);for(let e=0;e<t;++e){const t=this._dataLookup[e].buffer,i=e*o;r.set(new Uint8ClampedArray(t),i),n[e]=this._dataLookup[e].meta}}this._job=null,this._dataLookup={},e.callback(null,function(e,t,r){if(Dt)return new ImageData(e,t,r);Ot||(Ot=document.createElement("canvas").getContext("2d"));const n=Ot.createImageData(t,r);return n.data.set(e),n}(r,e.inputs[0].width,e.inputs[0].height),n),this._dispatch()}disposeInternal(){for(let e=0;e<this._workers.length;++e)this._workers[e].terminate();this._workers.length=0}}const Nt="beforeoperations",Ut="afteroperations";class Vt extends ee{constructor(e,t,r){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=r}}class Wt extends Rt{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=void 0!==e.operationType?e.operationType:"pixel",this.threads_=void 0!==e.threads?e.threads:1,this.layers_=function(e){const t=e.length,r=new Array(t);for(let n=0;n<t;++n)r[n]=Zt(e[n]);return r}(e.sources);const t=this.changed.bind(this);for(let n=0,i=this.layers_.length;n<i;++n)this.layers_[n].addEventListener(W.CHANGE,t);var r;this.useResolutions_=null!==e.resolutions,this.tileQueue_=new ge((function(){return 1}),this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:ye(),declutterTree:null,extent:null,index:0,layerIndex:0,layerStatesArray:(r=this.layers_,r.map((function(e){return e.getLayerState()}))),pixelRatio:1,pixelToCoordinateTransform:ye(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:a(this),renderTargets:{}},this.setAttributions((function(t){const r=[];for(let n=0,i=e.sources.length;n<i;++n){const i=e.sources[n],o=i instanceof Z?i:i.getSource();if(!o)continue;const a=o.getAttributions();if("function"==typeof a){const e=a(t);r.push.apply(r,e)}}return 0!==r.length?r:null})),void 0!==e.operation&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new Gt({operation:e,imageOps:"image"===this.operationType_,queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,r){const n=Object.assign({},this.frameState_);n.viewState=Object.assign({},n.viewState);const i=$(e);n.size[0]=Math.ceil(b(e)/t),n.size[1]=Math.ceil(w(e)/t),n.extent=[i[0]-n.size[0]*t/2,i[1]-n.size[1]*t/2,i[0]+n.size[0]*t/2,i[1]+n.size[1]*t/2],n.time=Date.now();const o=n.viewState;return o.center=i,o.projection=r,o.resolution=t,n}allSourcesReady_(){let e,t=!0;for(let r=0,n=this.layers_.length;r<n;++r)if(e=this.layers_[r].getSource(),!e||"ready"!==e.getState()){t=!1;break}return t}getImage(e,t,r,n){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const i=this.updateFrameState_(e,t,n);if(this.requestedFrameState_=i,this.renderedImageCanvas_){const e=this.renderedImageCanvas_.getResolution(),r=this.renderedImageCanvas_.getExtent();t===e&&B(i.extent,r)||(this.renderedImageCanvas_=null)}return this.renderedImageCanvas_&&this.getRevision()===this.renderedRevision_||this.processSources_(),i.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,r=new Array(t);for(let i=0;i<t;++i){e.layerIndex=i,e.renderTargets={};const t=Jt(this.layers_[i],e);if(!t)return;r[i]=t}const n={};this.dispatchEvent(new Vt(Nt,e,n)),this.processor_.process(r,n,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,r,n){if(t||!r)return;const i=e.extent,o=e.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!B(i,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const e=Math.round(b(i)/o),t=Math.round(w(i)/o);a=s(e,t),this.renderedImageCanvas_=new st(i,o,1,a.canvas)}a.putImageData(r,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new Vt(Ut,e,n))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let r=0,n=this.layers_.length;r<n;++r){if(t=this.layers_[r].getSource().getResolutions(e),t)break}return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}Wt.prototype.dispose;let Xt=null;function Jt(e,t){const r=e.getRenderer();if(!r)throw new Error("Unsupported layer type: "+e);if(!r.prepareFrame(t))return null;const n=t.size[0],i=t.size[1];if(0===n||0===i)return null;const o=r.renderFrame(t,null);let a;if(o instanceof HTMLCanvasElement)a=o;else{if(o&&(a=o.firstElementChild),!(a instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+a);if(a.width===n&&a.height===i){return a.getContext("2d").getImageData(0,0,n,i)}}if(Xt){const e=Xt.canvas;e.width!==n||e.height!==i?Xt=s(n,i,void 0,{willReadFrequently:!0}):Xt.clearRect(0,0,n,i)}else Xt=s(n,i,void 0,{willReadFrequently:!0});return Xt.drawImage(a,0,0,n,i),Xt.getImageData(0,0,n,i)}function Zt(e){let t;return e instanceof Z?e instanceof Lt?t=new Pt({source:e}):e instanceof Rt&&(t=new yt({source:e})):t=e,t}const Kt=Wt,Ht="tileloadstart",Bt="tileloadend",Yt="tileloaderror";class Qt extends Lt{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Qt.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,r=a(t),n=t.getState();let i;n==u.LOADING?(this.tileLoadingKeys_[r]=!0,i=Ht):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],i=n==u.ERROR?Yt:n==u.LOADED?Bt:void 0),null!=i&&this.dispatchEvent(new At(i,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),void 0!==t?this.setKey(t):this.changed()}setUrl(e){const t=ft(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(dt(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,r){}useTile(e,t,r){const n=me(e,t,r);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}const er=Qt;function tr(e,t){e.getImage().src=t}const rr=class extends er{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:tr,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:void 0===e.interpolate||e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=void 0!==e.crossOrigin?e.crossOrigin:null,this.tileClass=void 0!==e.tileClass?e.tileClass:ne,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const r=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==r?t:{});for(const n in this.tileCacheForProjection){const e=this.tileCacheForProjection[n];e.expireCache(e==r?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!H(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return!(this.getProjection()&&e&&!H(this.getProjection(),e))&&super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||H(t,e)))return this.tileGrid;const r=a(e);return r in this.tileGridForProjection||(this.tileGridForProjection[r]=ce(e)),this.tileGridForProjection[r]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||H(t,e))return this.tileCache;const r=a(e);return r in this.tileCacheForProjection||(this.tileCacheForProjection[r]=new lt(this.tileCache.highWaterMark)),this.tileCacheForProjection[r]}createTile_(e,t,r,n,i,o){const a=[e,t,r],s=this.getTileCoordForTileUrlFunction(a,i),l=s?this.tileUrlFunction(s,n,i):void 0,c=new this.tileClass(a,void 0!==l?u.IDLE:u.EMPTY,void 0!==l?l:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(W.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,r,n,o){const a=this.getProjection();if(!a||!o||H(a,o))return this.getTileInternal(e,t,r,n,a||o);const s=this.getTileCacheForProjection(o),l=[e,t,r];let u;const c=i(l);s.containsKey(c)&&(u=s.get(c));const p=this.getKey();if(u&&u.key==p)return u;const h=this.getTileGridForProjection(a),d=this.getTileGridForProjection(o),f=this.getTileCoordForTileUrlFunction(l,o),m=new ie(a,h,o,d,l,f,this.getTilePixelRatio(n),this.getGutter(),((e,t,r,n)=>this.getTileInternal(e,t,r,n,a)),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return m.key=p,u?(m.interimTile=u,m.refreshInterimChain(),s.replace(c,m)):s.set(c,m),m}getTileInternal(e,t,r,n,i){let o=null;const a=me(e,t,r),s=this.getKey();if(this.tileCache.containsKey(a)){if(o=this.tileCache.get(a),o.key!=s){const l=o;o=this.createTile_(e,t,r,n,i,s),l.getState()==u.IDLE?o.interimTile=l.interimTile:o.interimTile=l,o.refreshInterimChain(),this.tileCache.replace(a,o)}}else o=this.createTile_(e,t,r,n,i,s),this.tileCache.set(a,o);return o}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(e,t){const r=D(e);if(r){const e=a(r);e in this.tileGridForProjection||(this.tileGridForProjection[e]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}};const nr=class extends rr{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:D("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)!function(e,t,r,n){const i=document.createElement("script"),o="olc_"+a(t);function s(){delete window[o],i.parentNode.removeChild(i)}i.async=!0,i.src=e+(e.includes("?")?"&":"?")+(n||"callback")+"="+o;const l=setTimeout((function(){s(),r&&r()}),1e4);window[o]=function(e){clearTimeout(l),s(),t(e)},document.head.appendChild(i)}(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else{if(!e.tileJSON)throw new Error("Either `url` or `tileJSON` options must be provided");this.handleTileJSONResponse(e.tileJSON)}}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let e;try{e=JSON.parse(t.responseText)}catch(r){return void this.handleTileJSONError()}this.handleTileJSONResponse(e)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=D("EPSG:4326"),r=this.getProjection();let n;if(void 0!==e.bounds){const i=ve(t,r);n=be(e.bounds,i)}const i=we(r),o=e.minzoom||0,a=e.maxzoom||22,s=Te({extent:i,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=s,this.tileUrlFunction=dt(e.tiles,s),e.attribution&&!this.getAttributions()){const t=void 0!==n?n:i;this.setAttributions((function(r){return k(t,r.extent)?[e.attribution]:null}))}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}},ir={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},or={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};const ar=class extends Mt{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.tmpTransform_=ye()}prepareTile(e,t,r){let n;const i=e.getState();return i!==u.LOADED&&i!==u.ERROR||(this.updateExecutorGroup_(e,t,r),this.tileImageNeedsRender_(e)&&(n=!0)),n}getTile(e,t,r,n){const i=n.pixelRatio,o=n.viewState,a=o.resolution,s=o.projection,l=this.getLayer(),u=l.getSource().getTile(e,t,r,i,s),c=n.viewHints,p=!(c[g.ANIMATING]||c[g.INTERACTING]);!p&&u.wantedResolution||(u.wantedResolution=a);return this.prepareTile(u,i,s)&&(p||Date.now()-n.time<8)&&"vector"!==l.getRenderMode()&&this.renderTileImage_(u,n),super.getTile(e,t,r,n)}isDrawableTile(e){const t=this.getLayer();return super.isDrawableTile(e)&&("vector"===t.getRenderMode()?a(t)in e.executorGroups:e.hasContext(t))}getTileImage(e){return e.getImage(this.getLayer())}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,r){const n=this.getLayer(),i=n.getRevision(),o=n.getRenderOrder()||null,s=e.wantedResolution,l=e.getReplayState(n);if(!l.dirty&&l.renderedResolution===s&&l.renderedRevision==i&&l.renderedRenderOrder==o)return;const c=n.getSource(),p=n.getDeclutter(),h=c.getTileGrid(),d=c.getTileGridForProjection(r).getTileCoordExtent(e.wrappedTileCoord),m=c.getSourceTiles(t,r,e),g=a(n);delete e.hitDetectionImageData[g],e.executorGroups[g]=[],p&&(e.declutterExecutorGroups[g]=[]),l.dirty=!1;for(let a=0,y=m.length;a<y;++a){const r=m[a];if(r.getState()!=u.LOADED)continue;const i=r.tileCoord,y=h.getTileCoordExtent(i),x=f(d,y),v=_e(x,n.getRenderBuffer()*s,this.tmpExtent),b=B(y,x)?null:v,w=new Se(0,v,s,t),T=p?new Se(0,x,s,t):void 0,_=ke(s,t),S=function(e){let t;const r=e.getStyleFunction()||n.getStyleFunction();if(r&&(t=r(e,s)),t){const r=this.renderFeature(e,_,t,w,T);l.dirty=l.dirty||r}},z=r.getFeatures();o&&o!==l.renderedRenderOrder&&z.sort(o);for(let e=0,t=z.length;e<t;++e){const t=z[e];b&&!k(b,t.getGeometry().getExtent())||S.call(this,t)}const C=w.finish(),E="vector"!==n.getRenderMode()&&p&&1===m.length?null:x,R=new ze(E,s,t,c.getOverlaps(),C,n.getRenderBuffer());if(e.executorGroups[g].push(R),T){const r=new ze(null,s,t,c.getOverlaps(),T.finish(),n.getRenderBuffer());e.declutterExecutorGroups[g].push(r)}}l.renderedRevision=i,l.renderedRenderOrder=o,l.renderedResolution=s}forEachFeatureAtCoordinate(e,t,r,n,i){const o=t.viewState.resolution,s=t.viewState.rotation;r=null==r?0:r;const l=this.getLayer(),u=l.getSource().getTileGridForProjection(t.viewState.projection),c=Ce([e]);_e(c,o*r,c);const p={},h=function(e,t,r){let o=e.getId();void 0===o&&(o=a(e));const s=p[o];if(s){if(!0!==s&&r<s.distanceSq){if(0===r)return p[o]=!0,i.splice(i.lastIndexOf(s),1),n(e,l,t);s.geometry=t,s.distanceSq=r}}else{if(0===r)return p[o]=!0,n(e,l,t);i.push(p[o]={feature:e,layer:l,geometry:t,distanceSq:r,callback:n})}},d=this.renderedTiles;let f;for(let m=0,g=d.length;!f&&m<g;++m){const n=d[m],i=u.getTileCoordExtent(n.wrappedTileCoord);if(!k(i,c))continue;const p=a(l),g=[n.executorGroups[p]],y=n.declutterExecutorGroups[p];y&&g.push(y),g.some((n=>{const i=n===y?t.declutterTree.all().map((e=>e.value)):null;for(let t=0,a=n.length;t<a;++t){const a=n[t];if(f=a.forEachFeatureAtCoordinate(e,o,s,r,h,i),f)return!0}}))}return f}getFeatures(e){return new Promise(((t,r)=>{const n=this.getLayer(),i=a(n),o=n.getSource(),s=this.renderedProjection,l=s.getExtent(),c=this.renderedResolution,p=o.getTileGridForProjection(s),h=x(this.renderedPixelToCoordinateTransform_,e.slice()),d=p.getTileCoordForCoordAndResolution(h,c);let f;for(let e=0,a=this.renderedTiles.length;e<a;++e)if(d.toString()===this.renderedTiles[e].tileCoord.toString()){if(f=this.renderedTiles[e],f.getState()===u.LOADED){const e=p.getTileCoordExtent(f.tileCoord);o.getWrapX()&&s.canWrapX()&&!z(l,e)&&Ee(h,s);break}f=void 0}if(!f||f.loadingSourceTiles>0)return void t([]);const m=p.getTileCoordExtent(f.wrappedTileCoord),g=le(m),y=[(h[0]-g[0])/c,(g[1]-h[1])/c],v=f.getSourceTiles().reduce((function(e,t){return e.concat(t.getFeatures())}),[]);let b=f.hitDetectionImageData[i];if(!b){const e=oe(p.getTileSize(p.getZForResolution(c,o.zDirection))),t=this.renderedRotation_,r=[this.getRenderTransform(p.getTileCoordCenter(f.wrappedTileCoord),c,0,Re,e[0]*Re,e[1]*Re,0)];b=Ie(e,r,v,n.getStyleFunction(),p.getTileCoordExtent(f.wrappedTileCoord),f.getReplayState(n).renderedResolution,t),f.hitDetectionImageData[i]=b}t(je(y,v,b))}))}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,t){const r=this.context,n=r.globalAlpha;r.globalAlpha=t.opacity;const i=e.viewHints,o=!(i[g.ANIMATING]||i[g.INTERACTING]),s=this.renderedTiles;for(let l=0,u=s.length;l<u;++l){const t=s[l],r=t.declutterExecutorGroups[a(this.getLayer())];if(r)for(let n=r.length-1;n>=0;--n)r[n].execute(this.context,1,this.getTileRenderTransform(t,e),e.viewState.rotation,o,void 0,e.declutterTree)}r.globalAlpha=n}getTileRenderTransform(e,t){const r=t.pixelRatio,n=t.viewState,i=n.center,o=n.resolution,a=n.rotation,s=t.size,l=Math.round(s[0]*r),u=Math.round(s[1]*r),c=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),p=e.tileCoord,h=c.getTileCoordExtent(e.wrappedTileCoord),d=c.getTileCoordExtent(p,this.tmpExtent)[0]-h[0];return Fe(Me(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(i,o,a,r,l,u,d))}postRender(e,t){const r=t.viewHints,n=!(r[g.ANIMATING]||r[g.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation;const i=this.getLayer(),o=i.getRenderMode(),s=e.globalAlpha;e.globalAlpha=t.layerStatesArray[t.layerIndex].opacity;const l=or[o],u=t.viewState,c=u.rotation,p=i.getSource(),h=p.getTileGridForProjection(u.projection).getZForResolution(u.resolution,p.zDirection),d=this.renderedTiles,f=[],m=[];let y=!0;for(let g=d.length-1;g>=0;--g){const r=d[g];y=y&&!r.getReplayState(i).dirty;const o=r.executorGroups[a(i)].filter((e=>e.hasExecutors(l)));if(0===o.length)continue;const s=this.getTileRenderTransform(r,t),u=r.tileCoord[0];let p=!1;const x=o[0].getClipCoords(s);if(x){for(let t=0,r=f.length;t<r;++t)if(h!==u&&u<m[t]){const r=f[t];k([x[0],x[3],x[4],x[7]],[r[0],r[3],r[4],r[7]])&&(p||(e.save(),p=!0),e.beginPath(),e.moveTo(x[0],x[1]),e.lineTo(x[2],x[3]),e.lineTo(x[4],x[5]),e.lineTo(x[6],x[7]),e.moveTo(r[6],r[7]),e.lineTo(r[4],r[5]),e.lineTo(r[2],r[3]),e.lineTo(r[0],r[1]),e.clip())}f.push(x),m.push(u)}for(let t=0,i=o.length;t<i;++t){o[t].execute(e,1,s,c,n,l)}p&&e.restore()}e.globalAlpha=s,this.ready=y,super.postRender(e,t)}renderFeature(e,t,r,n,i){if(!r)return!1;let o=!1;if(Array.isArray(r))for(let a=0,s=r.length;a<s;++a)o=Pe(n,e,r[a],t,this.boundHandleStyleImageChange_,void 0,i)||o;else o=Pe(n,e,r,t,this.boundHandleStyleImageChange_,void 0,i);return o}tileImageNeedsRender_(e){const t=this.getLayer();if("vector"===t.getRenderMode())return!1;const r=e.getReplayState(t),n=t.getRevision(),i=e.wantedResolution;return r.renderedTileResolution!==i||r.renderedTileRevision!==n}renderTileImage_(e,t){const r=this.getLayer(),n=e.getReplayState(r),i=r.getRevision(),o=e.executorGroups[a(r)];n.renderedTileRevision=i;const s=e.wrappedTileCoord,l=s[0],u=r.getSource();let c=t.pixelRatio;const p=t.viewState.projection,h=u.getTileGridForProjection(p),d=h.getResolution(e.tileCoord[0]),f=t.pixelRatio/e.wantedResolution*d,m=h.getResolution(l),g=e.getContext(r);c=Math.round(Math.max(c,f/c));const y=u.getTilePixelSize(l,c,p);g.canvas.width=y[0],g.canvas.height=y[1];const x=c/f;if(1!==x){const e=Ae(this.tmpTransform_);Me(e,x,x),g.setTransform.apply(g,e)}const v=h.getTileCoordExtent(s,this.tmpExtent),b=f/m,w=Ae(this.tmpTransform_);Me(w,b,-b),Le(w,-v[0],-v[3]);for(let a=0,T=o.length;a<T;++a){o[a].execute(g,x,w,0,!0,ir[r.getRenderMode()])}n.renderedTileResolution=e.wantedResolution}};const sr=class extends Oe{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un;const r=e.renderMode||"hybrid";pe("hybrid"==r||"vector"==r,"`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=r,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError),this.getBackground,this.setBackground}createRenderer(){return new ar(this)}getFeatures(e){return super.getFeatures(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(It)}getUseInterimTilesOnError(){return this.get(jt)}setPreload(e){this.set(It,e)}setUseInterimTilesOnError(e){this.set(jt,e)}};const lr=class extends er{constructor(e){const t=e.projection||"EPSG:3857",r=e.extent||we(t),n=e.tileGrid||Te({extent:r,maxResolution:e.maxResolution,maxZoom:void 0!==e.maxZoom?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,opaque:!1,projection:t,state:e.state,tileGrid:n,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:ur,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:void 0===e.zDirection?1:e.zDirection}),this.format_=e.format?e.format:null,this.sourceTileCache=new lt(this.tileCache.highWaterMark),this.overlaps_=null==e.overlaps||e.overlaps,this.tileClass=e.tileClass?e.tileClass:pt,this.tileGrids_={}}getFeaturesInExtent(e){const t=[],r=this.tileCache;if(0===r.getCount())return t;const i=n(r.peekFirstKey())[0],o=this.tileGrid;return r.forEach((function(r){if(r.tileCoord[0]!==i||r.getState()!==u.LOADED)return;const n=r.getSourceTiles();for(let i=0,a=n.length;i<a;++i){const r=n[i],a=r.tileCoord;if(k(e,o.getTileCoordExtent(a))){const n=r.getFeatures();if(n)for(let r=0,i=n.length;r<i;++r){const i=n[r],o=i.getGeometry();k(e,o.getExtent())&&t.push(i)}}}})),t}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(e,t){const r=this.getTileCacheForProjection(e),n=Object.keys(t).reduce(((e,t)=>{const n=De(t),i=r.peek(n);if(i){const t=i.sourceTiles;for(let r=0,n=t.length;r<n;++r)e[t[r].getKey()]=!0}return e}),{});super.expireCache(e,t),this.sourceTileCache.expireCache(n)}getSourceTiles(e,t,r){if(r.getState()===u.IDLE){r.setState(u.LOADING);const n=r.wrappedTileCoord,i=this.getTileGridForProjection(t),o=i.getTileCoordExtent(n),a=n[0],s=i.getResolution(a);_e(o,-s,o);const l=this.tileGrid,c=l.getExtent();c&&f(o,c,o);const p=l.getZForResolution(s,this.zDirection);l.forEachTileCoord(o,p,(n=>{const i=this.tileUrlFunction(n,e,t),o=this.sourceTileCache.containsKey(i)?this.sourceTileCache.get(i):new this.tileClass(n,i?u.IDLE:u.EMPTY,i,this.format_,this.tileLoadFunction);r.sourceTiles.push(o);const a=o.getState();if(a<u.LOADED){const e=t=>{this.handleTileChange(t);const n=o.getState();if(n===u.LOADED||n===u.ERROR){const t=o.getKey();t in r.errorTileKeys?o.getState()===u.LOADED&&delete r.errorTileKeys[t]:r.loadingSourceTiles--,n===u.ERROR?r.errorTileKeys[t]=!0:o.removeEventListener(W.CHANGE,e),0===r.loadingSourceTiles&&r.setState(Ge(r.errorTileKeys)?u.LOADED:u.ERROR)}};o.addEventListener(W.CHANGE,e),r.loadingSourceTiles++}a===u.IDLE&&(o.extent=l.getTileCoordExtent(n),o.projection=t,o.resolution=l.getResolution(n[0]),this.sourceTileCache.set(i,o),o.load())})),r.loadingSourceTiles||r.setState(r.sourceTiles.some((e=>e.getState()===u.ERROR))?u.ERROR:u.LOADED)}return r.sourceTiles}getTile(e,t,r,n,i){const o=me(e,t,r),a=this.getKey();let s;if(this.tileCache.containsKey(o)&&(s=this.tileCache.get(o),s.key===a))return s;const l=[e,t,r];let c=this.getTileCoordForTileUrlFunction(l,i);const p=this.getTileGrid().getExtent(),h=this.getTileGridForProjection(i);if(c&&p){const t=h.getTileCoordExtent(c);_e(t,-h.getResolution(e),t),k(p,t)||(c=null)}let d=!0;if(null!==c){const t=this.tileGrid,r=h.getResolution(e),o=t.getZForResolution(r,1),a=h.getTileCoordExtent(c);_e(a,-r,a),t.forEachTileCoord(a,o,(e=>{d=d&&!this.tileUrlFunction(e,n,i)}))}const f=new ct(l,d?u.EMPTY:u.IDLE,c,this.getSourceTiles.bind(this,n,i));return f.key=a,s?(f.interimTile=s,f.refreshInterimChain(),this.tileCache.replace(o,f)):this.tileCache.set(o,f),f}getTileGridForProjection(e){const t=e.getCode();let r=this.tileGrids_[t];if(!r){const e=this.tileGrid,n=e.getResolutions().slice(),i=n.map((function(t,r){return e.getOrigin(r)})),o=n.map((function(t,r){return e.getTileSize(r)})),a=Ne+1;for(let t=n.length;t<a;++t)n.push(n[t-1]/2),i.push(i[t-1]),o.push(o[t-1]);r=new qe({extent:e.getExtent(),origins:i,resolutions:n,tileSizes:o}),this.tileGrids_[t]=r}return r}getTilePixelRatio(e){return e}getTilePixelSize(e,t,r){const n=this.getTileGridForProjection(r),i=oe(n.getTileSize(e),this.tmpSize);return[Math.round(i[0]*t),Math.round(i[1]*t)]}updateCacheSize(e,t){super.updateCacheSize(2*e,t),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(t).highWaterMark}};function ur(e,t){e.setLoader((function(r,n,i){$e(t,e.getFormat(),r,n,i,e.onLoad.bind(e),e.onError.bind(e))}))}function cr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var pr,hr={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function dr(e){return(e=Math.round(e))<0?0:e>255?255:e}function fr(e){return e<0?0:e>1?1:e}function mr(e){return"%"===e[e.length-1]?dr(parseFloat(e)/100*255):dr(parseInt(e))}function gr(e){return"%"===e[e.length-1]?fr(parseFloat(e)/100):fr(parseFloat(e))}function yr(e,t,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}try{pr={}.parseCSSColor=function(e){var t,r=e.replace(/ /g,"").toLowerCase();if(r in hr)return hr[r].slice();if("#"===r[0])return 4===r.length?(t=parseInt(r.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===r.length&&(t=parseInt(r.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var n=r.indexOf("("),i=r.indexOf(")");if(-1!==n&&i+1===r.length){var o=r.substr(0,n),a=r.substr(n+1,i-(n+1)).split(","),s=1;switch(o){case"rgba":if(4!==a.length)return null;s=gr(a.pop());case"rgb":return 3!==a.length?null:[mr(a[0]),mr(a[1]),mr(a[2]),s];case"hsla":if(4!==a.length)return null;s=gr(a.pop());case"hsl":if(3!==a.length)return null;var l=(parseFloat(a[0])%360+360)%360/360,u=gr(a[1]),c=gr(a[2]),p=c<=.5?c*(u+1):c+u-c*u,h=2*c-p;return[dr(255*yr(h,p,l+1/3)),dr(255*yr(h,p,l)),dr(255*yr(h,p,l-1/3)),s];default:return null}}return null}}catch(gs){}class xr{constructor(e,t,r,n=1){this.r=e,this.g=t,this.b=r,this.a=n}static parse(e){if(!e)return;if(e instanceof xr)return e;if("string"!=typeof e)return;const t=pr(e);return t?new xr(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,r,n]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(r)},${n})`}toArray(){const{r:e,g:t,b:r,a:n}=this;return 0===n?[0,0,0,0]:[255*e/n,255*t/n,255*r/n,n]}toArray01(){const{r:e,g:t,b:r,a:n}=this;return 0===n?[0,0,0,0]:[e/n,t/n,r/n,n]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:r,a:n}=this;return[e,t,r,n]}}xr.black=new xr(0,0,0,1),xr.white=new xr(1,1,1,1),xr.transparent=new xr(0,0,0,0),xr.red=new xr(1,0,0,1),xr.blue=new xr(0,0,1,1);var vr=xr;function br(e){return"object"==typeof e?["literal",e]:e}function wr(e,t){let r=e.stops;if(!r)return function(e,t){const r=["get",e.property];if(void 0===e.default)return"string"===t.type?["string",r]:r;if("enum"===t.type)return["match",r,Object.keys(t.values),r,e.default];{const n=["color"===t.type?"to-color":t.type,r,br(e.default)];return"array"===t.type&&n.splice(1,0,t.value,t.length||null),n}}(e,t);const n=r&&"object"==typeof r[0][0],i=n||void 0!==e.property,o=n||!i;return r=r.map((e=>!i&&t.tokens&&"string"==typeof e[1]?[e[0],Er(e[1])]:[e[0],br(e[1])])),n?function(e,t,r){const n={},i={},o=[];for(let s=0;s<r.length;s++){const t=r[s],a=t[0].zoom;void 0===n[a]&&(n[a]={zoom:a,type:e.type,property:e.property,default:e.default},i[a]=[],o.push(a)),i[a].push([t[0].value,t[1]])}const a=Cr({},t);if("exponential"===a){const r=[Tr(e),["linear"],["zoom"]];for(const e of o){zr(r,e,Sr(n[e],t,i[e]),!1)}return r}{const e=["step",["zoom"]];for(const r of o){zr(e,r,Sr(n[r],t,i[r]),!0)}return kr(e),e}}(e,t,r):o?function(e,t,r,n=["zoom"]){const i=Cr(e,t);let o,a=!1;if("interval"===i)o=["step",n],a=!0;else{if("exponential"!==i)throw new Error(`Unknown zoom function type "${i}"`);{const t=void 0!==e.base?e.base:1;o=[Tr(e),1===t?["linear"]:["exponential",t],n]}}for(const s of r)zr(o,s[0],s[1],a);return kr(o),o}(e,t,r):Sr(e,t,r)}function Tr(e){switch(e.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function _r(e,t){const r=br((n=e.default,i=t.default,void 0!==n?n:void 0!==i?i:void 0));var n,i;return void 0===r&&"resolvedImage"===t.type?"":r}function Sr(e,t,r){const n=Cr(e,t),i=["get",e.property];if("categorical"===n&&"boolean"==typeof r[0][0]){const n=["case"];for(const e of r)n.push(["==",i,e[0]],e[1]);return n.push(_r(e,t)),n}if("categorical"===n){const n=["match",i];for(const e of r)zr(n,e[0],e[1],!1);return n.push(_r(e,t)),n}if("interval"===n){const t=["step",["number",i]];for(const e of r)zr(t,e[0],e[1],!0);return kr(t),void 0===e.default?t:["case",["==",["typeof",i],"number"],t,br(e.default)]}if("exponential"===n){const t=void 0!==e.base?e.base:1,n=[Tr(e),1===t?["linear"]:["exponential",t],["number",i]];for(const e of r)zr(n,e[0],e[1],!1);return void 0===e.default?n:["case",["==",["typeof",i],"number"],n,br(e.default)]}throw new Error(`Unknown property function type ${n}`)}function kr(e){"step"===e[0]&&3===e.length&&(e.push(0),e.push(e[3]))}function zr(e,t,r,n){e.length>3&&t===e[e.length-2]||(n&&2===e.length||e.push(t),e.push(r))}function Cr(e,t){return e.type?e.type:t.expression.interpolated?"exponential":"interval"}function Er(e){const t=["concat"],r=/{([^{}]+)}/g;let n=0;for(let i=r.exec(e);null!==i;i=r.exec(e)){const o=e.slice(n,r.lastIndex-i[0].length);n=r.lastIndex,o.length>0&&t.push(o),t.push(["get",i[1]])}if(1===t.length)return e;if(n<e.length)t.push(e.slice(n));else if(2===t.length)return["to-string",t[1]];return t}class Rr extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var Ir=Rr;class jr{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[r,n]of t)this.bindings[r]=n}concat(e){return new jr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Fr=jr;const Mr={kind:"null"},Pr={kind:"number"},Ar={kind:"string"},Lr={kind:"boolean"},Or={kind:"color"},Dr={kind:"object"},qr={kind:"value"},$r={kind:"collator"},Gr={kind:"formatted"},Nr={kind:"resolvedImage"};function Ur(e,t){return{kind:"array",itemType:e,N:t}}function Vr(e){if("array"===e.kind){const t=Vr(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Wr=[Mr,Pr,Ar,Lr,Or,Gr,Dr,Ur(qr),Nr];function Xr(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Xr(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Wr)if(!Xr(e,t))return null}return`Expected ${Vr(e)} but found ${Vr(t)} instead.`}function Jr(e,t){return t.some((t=>t.kind===e.kind))}function Zr(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}class Kr{constructor(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Hr{constructor(e,t,r,n,i){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=r,this.fontStack=n,this.textColor=i}}class Br{constructor(e){this.sections=e}static fromString(e){return new Br([new Hr(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof Br?e:Br.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const r={};t.fontStack&&(r["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(r["font-scale"]=t.scale),t.textColor&&(r["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(r)}return e}}class Yr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Yr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Qr(e,t,r,n){if(!("number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof r&&r>=0&&r<=255)){return`Invalid rgba value [${("number"==typeof n?[e,t,r,n]:[e,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}return void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[e,t,r,n].join(", ")}]: 'a' must be between 0 and 1.`}function en(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof vr)return!0;if(e instanceof Kr)return!0;if(e instanceof Br)return!0;if(e instanceof Yr)return!0;if(Array.isArray(e)){for(const t of e)if(!en(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!en(e[t]))return!1;return!0}return!1}function tn(e){if(null===e)return Mr;if("string"==typeof e)return Ar;if("boolean"==typeof e)return Lr;if("number"==typeof e)return Pr;if(e instanceof vr)return Or;if(e instanceof Kr)return $r;if(e instanceof Br)return Gr;if(e instanceof Yr)return Nr;if(Array.isArray(e)){const t=e.length;let r;for(const n of e){const e=tn(n);if(r){if(r===e)continue;r=qr;break}r=e}return Ur(r||qr,t)}return Dr}function rn(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof vr||e instanceof Br||e instanceof Yr?e.toString():JSON.stringify(e)}class nn{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!en(e[1]))return t.error("invalid value");const r=e[1];let n=tn(r);const i=t.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new nn(n,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof vr?["rgba"].concat(this.value.toArray()):this.value instanceof Br?this.value.serialize():this.value}}var on=nn;var an=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const sn={string:Ar,number:Pr,boolean:Lr,object:Dr};class ln{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r,n=1;const i=e[0];if("array"===i){let i,o;if(e.length>2){const r=e[1];if("string"!=typeof r||!(r in sn)||"object"===r)return t.error('The item type argument of "array" must be one of string, number, boolean',1);i=sn[r],n++}else i=qr;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],n++}r=Ur(i,o)}else r=sn[i];const o=[];for(;n<e.length;n++){const r=t.parse(e[n],n,qr);if(!r)return null;o.push(r)}return new ln(r,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const r=this.args[t].evaluate(e);if(!Xr(this.type,tn(r)))return r;if(t===this.args.length-1)throw new an(`Expected value to be of type ${Vr(this.type)}, but found ${Vr(tn(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const r=e.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){t.push(r.kind);const n=e.N;("number"==typeof n||this.args.length>1)&&t.push(n)}}return t.concat(this.args.map((e=>e.serialize())))}}var un=ln;class cn{constructor(e){this.type=Gr,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return t.error("First argument must be an image or text section.");const n=[];let i=!1;for(let o=1;o<=e.length-1;++o){const r=e[o];if(i&&"object"==typeof r&&!Array.isArray(r)){i=!1;let e=null;if(r["font-scale"]&&(e=t.parse(r["font-scale"],1,Pr),!e))return null;let o=null;if(r["text-font"]&&(o=t.parse(r["text-font"],1,Ur(Ar)),!o))return null;let a=null;if(r["text-color"]&&(a=t.parse(r["text-color"],1,Or),!a))return null;const s=n[n.length-1];s.scale=e,s.font=o,s.textColor=a}else{const r=t.parse(e[o],1,qr);if(!r)return null;const a=r.type.kind;if("string"!==a&&"value"!==a&&"null"!==a&&"resolvedImage"!==a)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,n.push({content:r,scale:null,font:null,textColor:null})}}return new cn(n)}evaluate(e){return new Br(this.sections.map((t=>{const r=t.content.evaluate(e);return tn(r)===Nr?new Hr("",r,null,null,null):new Hr(rn(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const r={};t.scale&&(r["font-scale"]=t.scale.serialize()),t.font&&(r["text-font"]=t.font.serialize()),t.textColor&&(r["text-color"]=t.textColor.serialize()),e.push(r)}return e}}class pn{constructor(e){this.type=Nr,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const r=t.parse(e[1],1,Ar);return r?new pn(r):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),r=Yr.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const hn={"to-boolean":Lr,"to-color":Or,"to-number":Pr,"to-string":Ar};class dn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[0];if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return t.error("Expected one argument.");const n=hn[r],i=[];for(let o=1;o<e.length;o++){const r=t.parse(e[o],o,qr);if(!r)return null;i.push(r)}return new dn(n,i)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,r;for(const n of this.args){if(t=n.evaluate(e),r=null,t instanceof vr)return t;if("string"==typeof t){const r=e.parseColor(t);if(r)return r}else if(Array.isArray(t)&&(r=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Qr(t[0],t[1],t[2],t[3]),!r))return new vr(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new an(r||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const r of this.args){if(t=r.evaluate(e),null===t)return 0;const n=Number(t);if(!isNaN(n))return n}throw new an(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?Br.fromString(rn(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Yr.fromString(rn(this.args[0].evaluate(e))):rn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new cn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new pn(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}var fn=dn;const mn=["Unknown","Point","LineString","Polygon"];var gn=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?mn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:r,y:n}=this.featureTileCoord,i=r*t-e[0],o=n*t-e[1];return this.featureDistanceData.bearing[0]*i+this.featureDistanceData.bearing[1]*o}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=vr.parse(e)),t}};class yn{constructor(e,t,r,n){this.name=e,this.type=t,this._evaluate=r,this.args=n}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const r=e[0],n=yn.definitions[r];if(!n)return t.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const i=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,a=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let s=null;for(const[l,u]of a){s=new Wn(t.registry,t.path,null,t.scope);const n=[];let o=!1;for(let t=1;t<e.length;t++){const r=e[t],i=Array.isArray(l)?l[t-1]:l.type,a=s.parse(r,1+n.length,i);if(!a){o=!0;break}n.push(a)}if(!o)if(Array.isArray(l)&&l.length!==n.length)s.error(`Expected ${l.length} arguments, but found ${n.length} instead.`);else{for(let e=0;e<n.length;e++){const t=Array.isArray(l)?l[e]:l.type,r=n[e];s.concat(e+1).checkSubtype(t,r.type)}if(0===s.errors.length)return new yn(r,i,u,n)}}if(1===a.length)t.errors.push(...s.errors);else{const r=(a.length?a:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(Vr).join(", ")})`:`(${Vr(t.type)}...)`;var t})).join(" | "),n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],1+n.length);if(!r)return null;n.push(Vr(r.type))}t.error(`Expected arguments of type ${r}, but found (${n.join(", ")}) instead.`)}return null}static register(e,t){yn.definitions=t;for(const r in t)e[r]=yn}}var xn=yn;class vn{constructor(e,t,r){this.type=$r,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const r=e[1];if("object"!=typeof r||Array.isArray(r))return t.error("Collator options argument must be an object.");const n=t.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,Lr);if(!n)return null;const i=t.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,Lr);if(!i)return null;let o=null;return r.locale&&(o=t.parse(r.locale,1,Ar),!o)?null:new vn(n,i,o)}evaluate(e){return new Kr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const bn=8192;function wn(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Tn(e,t){return!(e[0]<=t[0])&&(!(e[2]>=t[2])&&(!(e[1]<=t[1])&&!(e[3]>=t[3])))}function _n(e,t){const r=(180+e[0])/360;const n=(i=e[1],(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360);var i;const o=Math.pow(2,t.z);return[Math.round(r*o*bn),Math.round(n*o*bn)]}function Sn(e,t,r){const n=e[0]-t[0],i=e[1]-t[1],o=e[0]-r[0],a=e[1]-r[1];return n*a-o*i==0&&n*o<=0&&i*a<=0}function kn(e,t){let r=!1;for(let a=0,s=t.length;a<s;a++){const s=t[a];for(let t=0,a=s.length;t<a-1;t++){if(Sn(e,s[t],s[t+1]))return!1;n=e,i=s[t],o=s[t+1],i[1]>n[1]!=o[1]>n[1]&&n[0]<(o[0]-i[0])*(n[1]-i[1])/(o[1]-i[1])+i[0]&&(r=!r)}}var n,i,o;return r}function zn(e,t){for(let r=0;r<t.length;r++)if(kn(e,t[r]))return!0;return!1}function Cn(e,t,r,n){const i=e[0]-r[0],o=e[1]-r[1],a=t[0]-r[0],s=t[1]-r[1],l=n[0]-r[0],u=n[1]-r[1],c=i*u-l*o,p=a*u-l*s;return c>0&&p<0||c<0&&p>0}function En(e,t,r,n){const i=[t[0]-e[0],t[1]-e[1]],o=[n[0]-r[0],n[1]-r[1]];return 0!=(a=o)[0]*(s=i)[1]-a[1]*s[0]&&!(!Cn(e,t,r,n)||!Cn(r,n,e,t));var a,s}function Rn(e,t,r){for(const n of r)for(let r=0;r<n.length-1;++r)if(En(e,t,n[r],n[r+1]))return!0;return!1}function In(e,t){for(let r=0;r<e.length;++r)if(!kn(e[r],t))return!1;for(let r=0;r<e.length-1;++r)if(Rn(e[r],e[r+1],t))return!1;return!0}function jn(e,t){for(let r=0;r<t.length;r++)if(In(e,t[r]))return!0;return!1}function Fn(e,t,r){const n=[];for(let i=0;i<e.length;i++){const o=[];for(let n=0;n<e[i].length;n++){const a=_n(e[i][n],r);wn(t,a),o.push(a)}n.push(o)}return n}function Mn(e,t,r){const n=[];for(let i=0;i<e.length;i++){const o=Fn(e[i],t,r);n.push(o)}return n}function Pn(e,t,r,n){if(e[0]<r[0]||e[0]>r[2]){const t=.5*n;let i=e[0]-r[0]>t?-n:r[0]-e[0]>t?n:0;0===i&&(i=e[0]-r[2]>t?-n:r[2]-e[0]>t?n:0),e[0]+=i}wn(t,e)}function An(e,t,r,n){const i=Math.pow(2,n.z)*bn,o=[n.x*bn,n.y*bn],a=[];if(!e)return a;for(const s of e)for(const e of s){const n=[e.x+o[0],e.y+o[1]];Pn(n,t,r,i),a.push(n)}return a}function Ln(e,t,r,n){const i=Math.pow(2,n.z)*bn,o=[n.x*bn,n.y*bn],a=[];if(!e)return a;for(const l of e){const e=[];for(const r of l){const n=[r.x+o[0],r.y+o[1]];wn(t,n),e.push(n)}a.push(e)}if(t[2]-t[0]<=i/2){(s=t)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(const e of a)for(const n of e)Pn(n,t,r,i)}var s;return a}class On{constructor(e,t){this.type=Lr,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(en(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const r=t.features[e].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new On(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new On(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new On(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const o=Fn(t.coordinates,n,i),a=An(e.geometry(),r,n,i);if(!Tn(r,n))return!1;for(const e of a)if(!kn(e,o))return!1}if("MultiPolygon"===t.type){const o=Mn(t.coordinates,n,i),a=An(e.geometry(),r,n,i);if(!Tn(r,n))return!1;for(const e of a)if(!zn(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const o=Fn(t.coordinates,n,i),a=Ln(e.geometry(),r,n,i);if(!Tn(r,n))return!1;for(const e of a)if(!In(e,o))return!1}if("MultiPolygon"===t.type){const o=Mn(t.coordinates,n,i),a=Ln(e.geometry(),r,n,i);if(!Tn(r,n))return!1;for(const e of a)if(!jn(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Dn=On;function qn(e){if(e instanceof xn){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Dn)return!1;let t=!0;return e.eachChild((e=>{t&&!qn(e)&&(t=!1)})),t}function $n(e){if(e instanceof xn&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!$n(e)&&(t=!1)})),t}function Gn(e,t){if(e instanceof xn&&t.indexOf(e.name)>=0)return!1;let r=!0;return e.eachChild((e=>{r&&!Gn(e,t)&&(r=!1)})),r}class Nn{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const r=e[1];return t.scope.has(r)?new Nn(r,t.scope.get(r)):t.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Un=Nn;class Vn{constructor(e,t=[],r,n=new Fr,i=[]){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=n,this.errors=i,this.expectedType=r}parse(e,t,r,n,i={}){return t?this.concat(t,r,n)._parse(e,i):this._parse(e,i)}_parse(e,t){function r(e,t,r){return"assert"===r?new un(t,[e]):"coerce"===r?new fn(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=e[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const i=this.registry[n];if(i){let n=i.parse(e,this);if(!n)return null;if(this.expectedType){const e=this.expectedType,i=n.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==i.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(e,i))return null}else n=r(n,e,t.typeAnnotation||"coerce");else n=r(n,e,t.typeAnnotation||"assert")}if(!(n instanceof on)&&"resolvedImage"!==n.type.kind&&Xn(n)){const e=new gn;try{n=new on(n.type,n.evaluate(e))}catch(gs){return this.error(gs.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return void 0===e?this.error("'undefined' value invalid. Use null instead."):"object"==typeof e?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,r){const n="number"==typeof e?this.path.concat(e):this.path,i=r?this.scope.concat(r):this.scope;return new Vn(this.registry,n,t||null,i,this.errors)}error(e,...t){const r=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new Ir(r,e))}checkSubtype(e,t){const r=Xr(e,t);return r&&this.error(r),r}}var Wn=Vn;function Xn(e){if(e instanceof Un)return Xn(e.boundExpression);if(e instanceof xn&&"error"===e.name)return!1;if(e instanceof vn)return!1;if(e instanceof Dn)return!1;const t=e instanceof fn||e instanceof un;let r=!0;return e.eachChild((e=>{r=t?r&&Xn(e):r&&e instanceof on})),!!r&&(qn(e)&&Gn(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]))}function Jn(e,t){const r=e.length-1;let n,i,o=0,a=r,s=0;for(;o<=a;)if(s=Math.floor((o+a)/2),n=e[s],i=e[s+1],n<=t){if(s===r||t<i)return s;o=s+1}else{if(!(n>t))throw new an("Input is not a number.");a=s-1}return 0}class Zn{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[n,i]of r)this.labels.push(n),this.outputs.push(i)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const r=t.parse(e[1],1,Pr);if(!r)return null;const n=[];let i=null;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);for(let o=1;o<e.length;o+=2){const r=1===o?-1/0:e[o],a=e[o+1],s=o,l=o+1;if("number"!=typeof r)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(n.length&&n[n.length-1][0]>=r)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const u=t.parse(a,l,i);if(!u)return null;i=i||u.type,n.push([r,u])}return new Zn(i,r,n)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);const i=t.length;if(n>=t[i-1])return r[i-1].evaluate(e);return r[Jn(t,n)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var Kn=Zn,Hn=Bn;function Bn(e,t,r,n){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=r,this.p2y=n}Bn.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},Bn.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},Bn.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},Bn.prototype.solveCurveX=function(e,t){var r,n,i,o,a;for(void 0===t&&(t=1e-6),i=e,a=0;a<8;a++){if(o=this.sampleCurveX(i)-e,Math.abs(o)<t)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=e)<(r=0))return r;if(i>(n=1))return n;for(;r<n;){if(o=this.sampleCurveX(i),Math.abs(o-e)<t)return i;e>o?r=i:n=i,i=.5*(n-r)+r}return i},Bn.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var Yn=cr(Hn);function Qn(e,t,r){return e*(1-r)+t*r}var ei=Object.freeze({__proto__:null,number:Qn,color:function(e,t,r){return new vr(Qn(e.r,t.r,r),Qn(e.g,t.g,r),Qn(e.b,t.b,r),Qn(e.a,t.a,r))},array:function(e,t,r){return e.map(((e,n)=>Qn(e,t[n],r)))}});const ti=.95047,ri=1,ni=1.08883,ii=4/29,oi=6/29,ai=3*oi*oi,si=oi*oi*oi,li=Math.PI/180,ui=180/Math.PI;function ci(e){return e>si?Math.pow(e,1/3):e/ai+ii}function pi(e){return e>oi?e*e*e:ai*(e-ii)}function hi(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function di(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function fi(e){const t=di(e.r),r=di(e.g),n=di(e.b),i=ci((.4124564*t+.3575761*r+.1804375*n)/ti),o=ci((.2126729*t+.7151522*r+.072175*n)/ri);return{l:116*o-16,a:500*(i-o),b:200*(o-ci((.0193339*t+.119192*r+.9503041*n)/ni)),alpha:e.a}}function mi(e){let t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200;return t=ri*pi(t),r=ti*pi(r),n=ni*pi(n),new vr(hi(3.2404542*r-1.5371385*t-.4985314*n),hi(-.969266*r+1.8760108*t+.041556*n),hi(.0556434*r-.2040259*t+1.0572252*n),e.alpha)}function gi(e,t,r){const n=t-e;return e+r*(n>180||n<-180?n-360*Math.round(n/360):n)}const yi={forward:fi,reverse:mi,interpolate:function(e,t,r){return{l:Qn(e.l,t.l,r),a:Qn(e.a,t.a,r),b:Qn(e.b,t.b,r),alpha:Qn(e.alpha,t.alpha,r)}}},xi={forward:function(e){const{l:t,a:r,b:n}=fi(e),i=Math.atan2(n,r)*ui;return{h:i<0?i+360:i,c:Math.sqrt(r*r+n*n),l:t,alpha:e.a}},reverse:function(e){const t=e.h*li,r=e.c;return mi({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:gi(e.h,t.h,r),c:Qn(e.c,t.c,r),l:Qn(e.l,t.l,r),alpha:Qn(e.alpha,t.alpha,r)}}};class vi{constructor(e,t,r,n,i){this.type=e,this.operator=t,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(const[o,a]of i)this.labels.push(o),this.outputs.push(a)}static interpolationFactor(e,t,r,n){let i=0;if("exponential"===e.name)i=bi(t,e.base,r,n);else if("linear"===e.name)i=bi(t,1,r,n);else if("cubic-bezier"===e.name){const o=e.controlPoints;i=new Yn(o[0],o[1],o[2],o[3]).solve(bi(t,1,r,n))}return i}static parse(e,t){let[r,n,i,...o]=e;if(!Array.isArray(n)||0===n.length)return t.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const e=n[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:e}}else{if("cubic-bezier"!==n[0])return t.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const e=n.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(i=t.parse(i,2,Pr),!i)return null;const a=[];let s=null;"interpolate-hcl"===r||"interpolate-lab"===r?s=Or:t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType);for(let l=0;l<o.length;l+=2){const e=o[l],r=o[l+1],n=l+3,i=l+4;if("number"!=typeof e)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(a.length&&a[a.length-1][0]>=e)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const u=t.parse(r,i,s);if(!u)return null;s=s||u.type,a.push([e,u])}return"number"===s.kind||"color"===s.kind||"array"===s.kind&&"number"===s.itemType.kind&&"number"==typeof s.N?new vi(s,r,n,i,a):t.error(`Type ${Vr(s)} is not interpolatable.`)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);const i=t.length;if(n>=t[i-1])return r[i-1].evaluate(e);const o=Jn(t,n),a=t[o],s=t[o+1],l=vi.interpolationFactor(this.interpolation,n,a,s),u=r[o].evaluate(e),c=r[o+1].evaluate(e);return"interpolate"===this.operator?ei[this.type.kind.toLowerCase()](u,c,l):"interpolate-hcl"===this.operator?xi.reverse(xi.interpolate(xi.forward(u),xi.forward(c),l)):yi.reverse(yi.interpolate(yi.forward(u),yi.forward(c),l))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t}}function bi(e,t,r,n){const i=n-r,o=e-r;return 0===i?0:1===t?o/i:(Math.pow(t,o)-1)/(Math.pow(t,i)-1)}var wi=vi;class Ti{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let r=null;const n=t.expectedType;n&&"value"!==n.kind&&(r=n);const i=[];for(const a of e.slice(1)){const e=t.parse(a,1+i.length,r,void 0,{typeAnnotation:"omit"});if(!e)return null;r=r||e.type,i.push(e)}const o=n&&i.some((e=>Xr(n,e.type)));return new Ti(o?qr:r,i)}evaluate(e){let t,r=null,n=0;for(const i of this.args){if(n++,r=i.evaluate(e),r&&r instanceof Yr&&!r.available&&(t||(t=r),r=null,n===this.args.length))return t;if(null!==r)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var _i=Ti;class Si{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let i=1;i<e.length-1;i+=2){const n=e[i];if("string"!=typeof n)return t.error(`Expected string, but found ${typeof n} instead.`,i);if(/[^a-zA-Z0-9_]/.test(n))return t.error("Variable names must contain only alphanumeric characters or '_'.",i);const o=t.parse(e[i+1],i+1);if(!o)return null;r.push([n,o])}const n=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return n?new Si(r,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,r]of this.bindings)e.push(t,r.serialize());return e.push(this.result.serialize()),e}}var ki=Si;class zi{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Pr),n=t.parse(e[2],2,Ur(t.expectedType||qr));if(!r||!n)return null;const i=n.type;return new zi(i.itemType,r,n)}evaluate(e){const t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new an(`Array index out of bounds: ${t} < 0.`);if(t>=r.length)throw new an(`Array index out of bounds: ${t} > ${r.length-1}.`);if(t!==Math.floor(t))throw new an(`Array index must be an integer, but found ${t} instead.`);return r[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Ci=zi;class Ei{constructor(e,t){this.type=Lr,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,qr),n=t.parse(e[2],2,qr);return r&&n?Jr(r.type,[Lr,Ar,Pr,Mr,qr])?new Ei(r,n):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(r.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(null==r)return!1;if(!Zr(t,["boolean","string","number","null"]))throw new an(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(tn(t))} instead.`);if(!Zr(r,["string","array"]))throw new an(`Expected second argument to be of type array or string, but found ${Vr(tn(r))} instead.`);return r.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Ri=Ei;class Ii{constructor(e,t,r){this.type=Pr,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,qr),n=t.parse(e[2],2,qr);if(!r||!n)return null;if(!Jr(r.type,[Lr,Ar,Pr,Mr,qr]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(r.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,Pr);return i?new Ii(r,n,i):null}return new Ii(r,n)}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Zr(t,["boolean","string","number","null"]))throw new an(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(tn(t))} instead.`);if(!Zr(r,["string","array"]))throw new an(`Expected second argument to be of type array or string, but found ${Vr(tn(r))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(e);return r.indexOf(t,n)}return r.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var ji=Ii;class Fi{constructor(e,t,r,n,i,o){this.inputType=e,this.type=t,this.input=r,this.cases=n,this.outputs=i,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let r,n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i={},o=[];for(let l=2;l<e.length-1;l+=2){let a=e[l];const s=e[l+1];Array.isArray(a)||(a=[a]);const u=t.concat(l);if(0===a.length)return u.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return u.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return u.error("Numeric branch labels must be integer values.");if(r){if(u.checkSubtype(r,tn(e)))return null}else r=tn(e);if(void 0!==i[String(e)])return u.error("Branch labels must be unique.");i[String(e)]=o.length}const c=t.parse(s,l,n);if(!c)return null;n=n||c.type,o.push(c)}const a=t.parse(e[1],1,qr);if(!a)return null;const s=t.parse(e[e.length-1],e.length-1,n);return s?"value"!==a.type.kind&&t.concat(1).checkSubtype(r,a.type)?null:new Fi(r,n,a,i,o,s):null}evaluate(e){const t=this.input.evaluate(e);return(tn(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),r=[],n={};for(const o of t){const e=n[this.cases[o]];void 0===e?(n[this.cases[o]]=r.length,r.push([this.cases[o],[o]])):r[e][1].push(o)}const i=e=>"number"===this.inputType.kind?Number(e):e;for(const[o,a]of r)1===a.length?e.push(i(a[0])):e.push(a.map(i)),e.push(this.outputs[o].serialize());return e.push(this.otherwise.serialize()),e}}var Mi=Fi;class Pi{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n=[];for(let o=1;o<e.length-1;o+=2){const i=t.parse(e[o],o,Lr);if(!i)return null;const a=t.parse(e[o+1],o+1,r);if(!a)return null;n.push([i,a]),r=r||a.type}const i=t.parse(e[e.length-1],e.length-1,r);return i?new Pi(r,n,i):null}evaluate(e){for(const[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Ai=Pi;class Li{constructor(e,t,r,n){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,qr),n=t.parse(e[2],2,Pr);if(!r||!n)return null;if(!Jr(r.type,[Ur(qr),Ar,qr]))return t.error(`Expected first argument to be of type array or string, but found ${Vr(r.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,Pr);return i?new Li(r.type,r,n,i):null}return new Li(r.type,r,n)}evaluate(e){const t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Zr(t,["string","array"]))throw new an(`Expected first argument to be of type array or string, but found ${Vr(tn(t))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(e);return t.slice(r,n)}return t.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Oi=Li;function Di(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function qi(e,t,r,n){return 0===n.compare(t,r)}function $i(e,t,r){const n="=="!==e&&"!="!==e;return class i{constructor(e,t,r){this.type=Lr,this.lhs=e,this.rhs=t,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const r=e[0];let o=t.parse(e[1],1,qr);if(!o)return null;if(!Di(r,o.type))return t.concat(1).error(`"${r}" comparisons are not supported for type '${Vr(o.type)}'.`);let a=t.parse(e[2],2,qr);if(!a)return null;if(!Di(r,a.type))return t.concat(2).error(`"${r}" comparisons are not supported for type '${Vr(a.type)}'.`);if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error(`Cannot compare types '${Vr(o.type)}' and '${Vr(a.type)}'.`);n&&("value"===o.type.kind&&"value"!==a.type.kind?o=new un(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new un(o.type,[a])));let s=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error("Cannot use collator to compare non-string types.");if(s=t.parse(e[3],3,$r),!s)return null}return new i(o,a,s)}evaluate(i){const o=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){const t=tn(o),r=tn(a);if(t.kind!==r.kind||"string"!==t.kind&&"number"!==t.kind)throw new an(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${r.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const e=tn(o),r=tn(a);if("string"!==e.kind||"string"!==r.kind)return t(i,o,a)}return this.collator?r(i,o,a,this.collator.evaluate(i)):t(i,o,a)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const Gi=$i("==",(function(e,t,r){return t===r}),qi),Ni=$i("!=",(function(e,t,r){return t!==r}),(function(e,t,r,n){return!qi(0,t,r,n)})),Ui=$i("<",(function(e,t,r){return t<r}),(function(e,t,r,n){return n.compare(t,r)<0})),Vi=$i(">",(function(e,t,r){return t>r}),(function(e,t,r,n){return n.compare(t,r)>0})),Wi=$i("<=",(function(e,t,r){return t<=r}),(function(e,t,r,n){return n.compare(t,r)<=0})),Xi=$i(">=",(function(e,t,r){return t>=r}),(function(e,t,r,n){return n.compare(t,r)>=0}));class Ji{constructor(e,t,r,n,i,o){this.type=Ar,this.number=e,this.locale=t,this.currency=r,this.unit=n,this.minFractionDigits=i,this.maxFractionDigits=o}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const r=t.parse(e[1],1,Pr);if(!r)return null;const n=e[2];if("object"!=typeof n||Array.isArray(n))return t.error("NumberFormat options argument must be an object.");let i=null;if(n.locale&&(i=t.parse(n.locale,1,Ar),!i))return null;let o=null;if(n.currency&&(o=t.parse(n.currency,1,Ar),!o))return null;let a=null;if(n.unit&&(a=t.parse(n.unit,1,Ar),!a))return null;let s=null;if(n["min-fraction-digits"]&&(s=t.parse(n["min-fraction-digits"],1,Pr),!s))return null;let l=null;return n["max-fraction-digits"]&&(l=t.parse(n["max-fraction-digits"],1,Pr),!l)?null:new Ji(r,i,o,a,s,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Zi{constructor(e){this.type=Pr,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=t.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?t.error(`Expected argument of type string or array, but found ${Vr(r.type)} instead.`):new Zi(r):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new an(`Expected value to be of type string or array, but found ${Vr(tn(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}const Ki={"==":Gi,"!=":Ni,">":Vi,"<":Ui,">=":Xi,"<=":Wi,array:un,at:Ci,boolean:un,case:Ai,coalesce:_i,collator:vn,format:cn,image:pn,in:Ri,"index-of":ji,interpolate:wi,"interpolate-hcl":wi,"interpolate-lab":wi,length:Zi,let:ki,literal:on,match:Mi,number:un,"number-format":Ji,object:un,slice:Oi,step:Kn,string:un,"to-boolean":fn,"to-color":fn,"to-number":fn,"to-string":fn,var:Un,within:Dn};function Hi(e,[t,r,n,i]){t=t.evaluate(e),r=r.evaluate(e),n=n.evaluate(e);const o=i?i.evaluate(e):1,a=Qr(t,r,n,o);if(a)throw new an(a);return new vr(t/255*o,r/255*o,n/255*o,o)}function Bi(e,t){return e in t}function Yi(e,t){const r=t[e];return void 0===r?null:r}function Qi(e){return{type:e}}xn.register(Ki,{error:[{kind:"error"},[Ar],(e,[t])=>{throw new an(t.evaluate(e))}],typeof:[Ar,[qr],(e,[t])=>Vr(tn(t.evaluate(e)))],"to-rgba":[Ur(Pr,4),[Or],(e,[t])=>t.evaluate(e).toArray()],rgb:[Or,[Pr,Pr,Pr],Hi],rgba:[Or,[Pr,Pr,Pr,Pr],Hi],has:{type:Lr,overloads:[[[Ar],(e,[t])=>Bi(t.evaluate(e),e.properties())],[[Ar,Dr],(e,[t,r])=>Bi(t.evaluate(e),r.evaluate(e))]]},get:{type:qr,overloads:[[[Ar],(e,[t])=>Yi(t.evaluate(e),e.properties())],[[Ar,Dr],(e,[t,r])=>Yi(t.evaluate(e),r.evaluate(e))]]},"feature-state":[qr,[Ar],(e,[t])=>Yi(t.evaluate(e),e.featureState||{})],properties:[Dr,[],e=>e.properties()],"geometry-type":[Ar,[],e=>e.geometryType()],id:[qr,[],e=>e.id()],zoom:[Pr,[],e=>e.globals.zoom],pitch:[Pr,[],e=>e.globals.pitch||0],"distance-from-center":[Pr,[],e=>e.distanceFromCenter()],"heatmap-density":[Pr,[],e=>e.globals.heatmapDensity||0],"line-progress":[Pr,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[Pr,[],e=>e.globals.skyRadialProgress||0],accumulated:[qr,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Pr,Qi(Pr),(e,t)=>{let r=0;for(const n of t)r+=n.evaluate(e);return r}],"*":[Pr,Qi(Pr),(e,t)=>{let r=1;for(const n of t)r*=n.evaluate(e);return r}],"-":{type:Pr,overloads:[[[Pr,Pr],(e,[t,r])=>t.evaluate(e)-r.evaluate(e)],[[Pr],(e,[t])=>-t.evaluate(e)]]},"/":[Pr,[Pr,Pr],(e,[t,r])=>t.evaluate(e)/r.evaluate(e)],"%":[Pr,[Pr,Pr],(e,[t,r])=>t.evaluate(e)%r.evaluate(e)],ln2:[Pr,[],()=>Math.LN2],pi:[Pr,[],()=>Math.PI],e:[Pr,[],()=>Math.E],"^":[Pr,[Pr,Pr],(e,[t,r])=>Math.pow(t.evaluate(e),r.evaluate(e))],sqrt:[Pr,[Pr],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Pr,[Pr],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Pr,[Pr],(e,[t])=>Math.log(t.evaluate(e))],log2:[Pr,[Pr],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Pr,[Pr],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Pr,[Pr],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Pr,[Pr],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Pr,[Pr],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Pr,[Pr],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Pr,[Pr],(e,[t])=>Math.atan(t.evaluate(e))],min:[Pr,Qi(Pr),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[Pr,Qi(Pr),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[Pr,[Pr],(e,[t])=>Math.abs(t.evaluate(e))],round:[Pr,[Pr],(e,[t])=>{const r=t.evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[Pr,[Pr],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Pr,[Pr],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Lr,[Ar,qr],(e,[t,r])=>e.properties()[t.value]===r.value],"filter-id-==":[Lr,[qr],(e,[t])=>e.id()===t.value],"filter-type-==":[Lr,[Ar],(e,[t])=>e.geometryType()===t.value],"filter-<":[Lr,[Ar,qr],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n<i}],"filter-id-<":[Lr,[qr],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r<n}],"filter->":[Lr,[Ar,qr],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n>i}],"filter-id->":[Lr,[qr],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r>n}],"filter-<=":[Lr,[Ar,qr],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n<=i}],"filter-id-<=":[Lr,[qr],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r<=n}],"filter->=":[Lr,[Ar,qr],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n>=i}],"filter-id->=":[Lr,[qr],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r>=n}],"filter-has":[Lr,[qr],(e,[t])=>t.value in e.properties()],"filter-has-id":[Lr,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Lr,[Ur(Ar)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Lr,[Ur(qr)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Lr,[Ar,Ur(qr)],(e,[t,r])=>r.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Lr,[Ar,Ur(qr)],(e,[t,r])=>function(e,t,r,n){for(;r<=n;){const i=r+n>>1;if(t[i]===e)return!0;t[i]>e?n=i-1:r=i+1}return!1}(e.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Lr,overloads:[[[Lr,Lr],(e,[t,r])=>t.evaluate(e)&&r.evaluate(e)],[Qi(Lr),(e,t)=>{for(const r of t)if(!r.evaluate(e))return!1;return!0}]]},any:{type:Lr,overloads:[[[Lr,Lr],(e,[t,r])=>t.evaluate(e)||r.evaluate(e)],[Qi(Lr),(e,t)=>{for(const r of t)if(r.evaluate(e))return!0;return!1}]]},"!":[Lr,[Lr],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Lr,[Ar],(e,[t])=>{const r=e.globals&&e.globals.isSupportedScript;return!r||r(t.evaluate(e))}],upcase:[Ar,[Ar],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Ar,[Ar],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Ar,Qi(qr),(e,t)=>t.map((t=>rn(t.evaluate(e)))).join("")],"resolved-locale":[Ar,[$r],(e,[t])=>t.evaluate(e).resolvedLocale()]});var eo=Ki;function to(e){return{result:"success",value:e}}function ro(e){return{result:"error",value:e}}function no(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}class io{constructor(e,t){var r;this.expression=e,this._warningHistory={},this._evaluator=new gn,this._defaultValue=t?"color"===(r=t).type&&(no(r.default)||Array.isArray(r.default))?new vr(0,0,0,0):"color"===r.type?vr.parse(r.default)||null:void 0===r.default?null:r.default:null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,r,n,i,o,a,s){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,n,i,o,a,s){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new an(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(gs){return this._warningHistory[gs.message]||(this._warningHistory[gs.message]=!0,"undefined"!=typeof console&&console.warn(gs.message)),this._defaultValue}}}function oo(e,t){const r=new Wn(eo,[],t?function(e){const t={color:Or,string:Ar,number:Pr,enum:Ar,boolean:Lr,formatted:Gr,resolvedImage:Nr};if("array"===e.type)return Ur(t[e.value]||qr,e.length);return t[e.type]}(t):void 0),n=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return n?to(new io(n,t)):ro(r.errors)}class ao{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!$n(t.expression)}evaluateWithoutErrorHandling(e,t,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,o)}evaluate(e,t,r,n,i,o){return this._styleExpression.evaluate(e,t,r,n,i,o)}}class so{constructor(e,t,r,n){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent="camera"!==e&&!$n(t.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,t,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,o)}evaluate(e,t,r,n,i,o){return this._styleExpression.evaluate(e,t,r,n,i,o)}interpolationFactor(e,t,r){return this.interpolationType?wi.interpolationFactor(this.interpolationType,e,t,r):0}}function lo(e,t){if("error"===(e=oo(e,t)).result)return e;const r=e.value.expression,n=qn(r);if(!n&&"data-driven"!==t["property-type"])return ro([new Ir("","data expressions not supported")]);const i=Gn(r,["zoom","pitch","distance-from-center"]);if(!i&&!function(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}(t))return ro([new Ir("","zoom expressions not supported")]);const o=uo(r);if(!o&&!i)return ro([new Ir("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof Ir)return ro([o]);if(o instanceof wi&&!function(e){return!!e.expression&&e.expression.interpolated}(t))return ro([new Ir("",'"interpolate" expressions cannot be used with this property')]);if(!o)return to(new ao(n?"constant":"source",e.value));const a=o instanceof wi?o.interpolation:void 0;return to(new so(n?"camera":"composite",e.value,o.labels,a))}function uo(e){let t=null;if(e instanceof ki)t=uo(e.result);else if(e instanceof _i){for(const r of e.args)if(t=uo(r),t)break}else(e instanceof Kn||e instanceof wi)&&e.input instanceof xn&&"zoom"===e.input.name&&(t=e);return t instanceof Ir||e.eachChild((e=>{const r=uo(e);r instanceof Ir?t=r:!t&&r?t=new Ir("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&r&&t!==r&&(t=new Ir("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function co(e){if(Array.isArray(e))return e.map(co);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const r in e)t[r]=co(e[r]);return t}return function(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}(e)}var po={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},projection:{type:"projection"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"fill-extrusion-edge-radius":{type:"number",private:!0,default:0,minimum:0,maximum:1,"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_symbol:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},in:{group:"Lookup"},"index-of":{group:"Lookup"},slice:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},image:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Camera"},pitch:{group:"Camera"},"distance-from-center":{group:"Camera"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},"sky-radial-progress":{group:"sky"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},distance:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},within:{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"high-color":{type:"color","property-type":"data-constant",default:"#245cdf",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"space-color":{type:"color","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,.2,7,.1],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"star-intensity":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],5,.35,6,0],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},projection:{name:{type:"enum",values:{albers:{},equalEarth:{},equirectangular:{},lambertConformalConic:{},mercator:{},naturalEarth:{},winkelTripel:{},globe:{}},default:"mercator",required:!0},center:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-180,-90],maximum:[180,90],transition:!1,requires:[{name:["albers","lambertConformalConic"]}]},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-90,-90],maximum:[90,90],transition:!1,requires:[{name:["albers","lambertConformalConic"]}]}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,requires:["source"]}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant",type:"number",private:!0,default:0,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant",type:"number",private:!0,default:3,minimum:0,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,requires:["fill-extrusion-edge-radius"]}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!1,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{type:"array",value:"number",length:2,default:[0,0],minimum:[0,0],maximum:[1,1],transition:!1,requires:[{source:"geojson",has:{lineMetrics:!0}}],"property-type":"constant"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};function ho(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!ho(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function fo(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ho(e)||(e=wo(e));const r=e;let n=!0;try{n=function(e){if(!yo(e))return e;let t=co(e);return go(t),t=mo(t),t}(r)}catch(gs){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(r,null,2)}\n        `)}const i=po[`filter_${t}`],o=oo(n,i);let a=null;if("error"===o.result)throw new Error(o.value.map((e=>`${e.key}: ${e.message}`)).join(", "));a=(e,t,r)=>o.value.evaluate(e,t,{},r);let s=null,l=null;if(n!==r){const e=oo(r,i);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));s=(t,r,n,i,o)=>e.value.evaluate(t,r,{},n,void 0,void 0,i,o),l=!qn(e.value.expression)}return{filter:a,dynamicFilter:s||void 0,needGeometry:bo(n),needFeature:!!l}}function mo(e){if(!Array.isArray(e))return e;const t=function(e){if(xo.has(e[0]))for(let t=1;t<e.length;t++){if(yo(e[t]))return!0}return e}(e);return!0===t?t:t.map((e=>mo(e)))}function go(e){let t=!1;const r=[];if("case"===e[0]){for(let n=1;n<e.length-1;n+=2)t=t||yo(e[n]),r.push(e[n+1]);r.push(e[e.length-1])}else if("match"===e[0]){t=t||yo(e[1]);for(let t=2;t<e.length-1;t+=2)r.push(e[t+1]);r.push(e[e.length-1])}else if("step"===e[0]){t=t||yo(e[1]);for(let t=1;t<e.length-1;t+=2)r.push(e[t+1])}t&&(e.length=0,e.push("any",...r));for(let n=1;n<e.length;n++)go(e[n])}function yo(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let r=1;r<e.length;r++){if(yo(e[r]))return!0}return!1}const xo=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function vo(e,t){return e<t?-1:e>t?1:0}function bo(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let t=1;t<e.length;t++)if(bo(e[t]))return!0;return!1}function wo(e){if(!e)return!0;const t=e[0];if(e.length<=1)return"any"!==t;var r;return"=="===t?To(e[1],e[2],"=="):"!="===t?ko(To(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?To(e[1],e[2],t):"any"===t?(r=e.slice(1),["any"].concat(r.map(wo))):"all"===t?["all"].concat(e.slice(1).map(wo)):"none"===t?["all"].concat(e.slice(1).map(wo).map(ko)):"in"===t?_o(e[1],e.slice(2)):"!in"===t?ko(_o(e[1],e.slice(2))):"has"===t?So(e[1]):"!has"===t?ko(So(e[1])):"within"!==t||e}function To(e,t,r){switch(e){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,e,t]}}function _o(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(vo)]]:["filter-in-small",e,["literal",t]]}}function So(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function ko(e){return["!",e]}var zo=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Co(e,t){const r={};for(const n in e)"ref"!==n&&(r[n]=e[n]);return zo.forEach((e=>{e in t&&(r[e]=t[e])})),r}function Eo(e){e=e.slice();const t=Object.create(null);for(let r=0;r<e.length;r++)t[e[r].id]=e[r];for(let r=0;r<e.length;r++)"ref"in e[r]&&(e[r]=Co(e[r],t[e[r].ref]));return e}var Ro={thin:100,hairline:100,"ultra-light":100,"extra-light":100,light:200,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,heavy:800,black:800,"extra-bold":800,"ultra-black":900,"extra-black":900,"ultra-bold":900,"heavy-black":900,fat:900,poster:900},Io=" ",jo=/(italic|oblique)$/i,Fo={},Mo=cr((function(e,t,r){var n=Fo[e];if(!n){Array.isArray(e)||(e=[e]);for(var i=400,o="normal",a=[],s=0,l=e.length;s<l;++s){var u=e[s].split(" "),c=u[u.length-1].toLowerCase();for(var p in"normal"==c||"italic"==c||"oblique"==c?(o=c,u.pop(),c=u[u.length-1].toLowerCase()):jo.test(c)&&(c=c.replace(jo,""),o=u[u.length-1].replace(c,"")),Ro){var h=u.length>1?u[u.length-2].toLowerCase():"";if(c==p||c==p.replace("-","")||h+"-"+c==p){i=Ro[p],u.pop(),h&&p.startsWith(h)&&u.pop();break}}"number"==typeof c&&(i=c);var d=u.join(Io).replace("Klokantech Noto Sans","Noto Sans");-1!==d.indexOf(Io)&&(d='"'+d+'"'),a.push(d)}n=Fo[e]=[o,i,a]}return n[0]+Io+n[1]+Io+t+"px"+(r?"/"+r:"")+Io+n[2]}));const Po="https://api.mapbox.com";function Ao(e){const t="mapbox://";return 0!==e.indexOf(t)?"":e.slice(9)}function Lo(e,t){const r=Ao(e);if(!r)return decodeURI(new URL(e,location.href).href);const n="styles/";if(0!==r.indexOf(n))throw new Error(`unexpected style url: ${e}`);const i=r.slice(7);return`${Po}/styles/v1/${i}?&access_token=${t}`}function Oo(e,t,r,n){const i=new URL(e,n),o=Ao(e);if(!o)return t?(i.searchParams.has(r)||i.searchParams.set(r,t),decodeURI(i.href)):decodeURI(i.href);if("mapbox.satellite"===o){return`https://api.mapbox.com/v4/${o}/{z}/{x}/{y}${window.devicePixelRatio>=1.5?"@2x":""}.webp?access_token=${t}`}return`https://{a-d}.tiles.mapbox.com/v4/${o}/{z}/{x}/{y}.vector.pbf?access_token=${t}`}const Do={},qo={};let $o=0;function Go(e){return e.id||(e.id=$o++),e.id}function No(e,t){return Go(e)+"."+a(t)}function Uo(e){let t=Do[e.id];return t||(t={},Do[Go(e)]=t),t}function Vo(e){let t=qo[e.id];return t||(t={},qo[Go(e)]=t),t}function Wo(e){return e*Math.PI/180}const Xo=function(){const e=[];for(let t=78271.51696402048;e.length<=24;t/=2)e.push(t);return e}(),Jo=new qe({extent:D("EPSG:3857").getExtent(),resolutions:Xo});function Zo(e,t){if("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(e,t);const r=document.createElement("canvas");return r.width=e,r.height=t,r}function Ko(e,t){let r=0;const n=t.length;for(;r<n;++r){if(t[r]<e&&r+1<n){const n=t[r]/t[r+1];return r+Math.log(t[r]/e)/Math.log(n)}}return n-1}const Ho={};function Bo(e,t,r={},n){if(t in Ho)return n&&(n.request=Ho[t][0]),Ho[t][1];const i=r.transformRequest&&r.transformRequest(t,e)||t,o=Ue((()=>i)).then((e=>(e instanceof Request||(e=new Request(e)),e.headers.get("Accept")||e.headers.set("Accept","application/json"),n&&(n.request=e),fetch(e).then((function(e){return delete Ho[t],e.ok?e.json():Promise.reject(new Error("Error fetching source "+t))})).catch((function(e){return delete Ho[t],Promise.reject(new Error("Error fetching source "+t))})))));return Ho[t]=[i,o],o}function Yo(e,t){if("string"!=typeof e)return Promise.resolve(e);if(!e.trim().startsWith("{"))return Bo("Style",e=Lo(e,t.accessToken),t);try{const t=JSON.parse(e);return Promise.resolve(t)}catch(r){return Promise.reject(r)}}const Qo={};function ea(e,t,r={}){const n=[t,JSON.stringify(e)].toString();let i=Qo[n];if(!i||r.transformRequest){let o;r.transformRequest&&(o=(e,t)=>{const n=r.transformRequest&&r.transformRequest(t,"Tiles")||t;if(e instanceof pt)e.setLoader(((t,r,i)=>{Ue((()=>n)).then((r=>{fetch(r).then((e=>e.arrayBuffer())).then((r=>{const n=e.getFormat().readFeatures(r,{extent:t,featureProjection:i});e.setFeatures(n)})).catch((t=>e.setState(u.ERROR)))}))}));else{const t=e.getImage();Ue((()=>n)).then((r=>{r instanceof Request?fetch(r).then((e=>e.blob())).then((e=>{const r=URL.createObjectURL(e);t.addEventListener("load",(()=>URL.revokeObjectURL(r))),t.addEventListener("error",(()=>URL.revokeObjectURL(r))),t.src=r})).catch((t=>e.setState(u.ERROR))):t.src=r}))}});const a=e.url;if(a&&!e.tiles){const n=Oo(a,r.accessToken,r.accessTokenParam||"access_token",t||location.href);if(a.startsWith("mapbox://"))i=Promise.resolve({tileJson:Object.assign({},e,{url:void 0,tiles:ft(n)}),tileLoadFunction:o});else{const e={};i=Bo("Source",n,r,e).then((function(t){return t.tiles=t.tiles.map((function(n){return"tms"===t.scheme&&(n=n.replace("{y}","{-y}")),Oo(n,r.accessToken,r.accessTokenParam||"access_token",e.request.url)})),Promise.resolve({tileJson:t,tileLoadFunction:o})}))}}else e=Object.assign({},e,{tiles:e.tiles.map((function(n){return"tms"===e.scheme&&(n=n.replace("{y}","{-y}")),Oo(n,r.accessToken,r.accessTokenParam||"access_token",t||location.href)}))}),i=Promise.resolve({tileJson:Object.assign({},e),tileLoadFunction:o});Qo[n]=i}return i}function ta(e,t,r,n){const i=document.createElement("canvas"),o=[2*r*t.pixelRatio+t.width,2*r*t.pixelRatio+t.height];i.width=o[0],i.height=o[1];const a=i.getContext("2d");a.drawImage(e,t.x,t.y,t.width,t.height,r*t.pixelRatio,r*t.pixelRatio,t.width,t.height);const s=a.getImageData(0,0,o[0],o[1]);a.globalCompositeOperation="destination-over",a.fillStyle=`rgba(${255*n.r},${255*n.g},${255*n.b},${n.a})`;const l=s.data;for(let u=0,c=s.width;u<c;++u)for(let e=0,n=s.height;e<n;++e){l[4*(e*c+u)+3]>0&&a.arc(u,e,r*t.pixelRatio,0,2*Math.PI)}return a.fill(),i}function ra(e,t,r){const n=Math.max(0,Math.min(1,(r-e)/(t-e)));return n*n*(3-2*n)}function na(e,t,r){const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const i=n.getContext("2d");i.drawImage(e,t.x,t.y,t.width,t.height,0,0,t.width,t.height);const o=i.getImageData(0,0,t.width,t.height),a=o.data;for(let s=0,l=o.width;s<l;++s)for(let e=0,t=o.height;e<t;++e){const t=4*(e*l+s),n=.75,i=.1,o=ra(n-i,n+i,a[t+3]/255);o>0?(a[t+0]=Math.round(255*r.r*o),a[t+1]=Math.round(255*r.g*o),a[t+2]=Math.round(255*r.b*o),a[t+3]=Math.round(255*o)):a[t+3]=0}return i.putImageData(o,0,0),n}const ia=Array(256).join("");function oa(e,t){if(t>=.05){let r="";const n=e.split("\n"),i=ia.slice(0,Math.round(t/.1));for(let e=0,t=n.length;e<t;++e)e>0&&(r+="\n"),r+=n[e].split("").join(i);return r}return e}let aa;function sa(){return aa||(aa=Zo(1,1).getContext("2d")),aa}function la(e,t){return sa().measureText(e).width+(e.length-1)*t}const ua={};function ca(e,t,r,n){if(-1!==e.indexOf("\n")){const i=e.split("\n"),o=[];for(let e=0,a=i.length;e<a;++e)o.push(ca(i[e],t,r,n));return o.join("\n")}const i=r+","+t+","+e+","+n;let o=ua[i];if(!o){const a=e.split(" ");if(a.length>1){const e=sa();e.font=t;const i=e.measureText("M").width*r;let s="";const l=[];for(let t=0,r=a.length;t<r;++t){const e=a[t],r=s+(s?" ":"")+e;la(r,n)<=i?s=r:(s&&l.push(s),s=e)}s&&l.push(s);for(let t=0,r=l.length;t<r&&r>1;++t){const e=l[t];if(la(e,n)<.35*i){const i=t>0?la(l[t-1],n):1/0,o=t<r-1?la(l[t+1],n):1/0;l.splice(t,1),r-=1,i<o?(l[t-1]+=" "+e,t-=1):l[t]=e+" "+l[t]}}for(let t=0,r=l.length-1;t<r;++t){const e=l[t],o=l[t+1];if(la(e,n)>.7*i&&la(o,n)<.6*i){const a=e.split(" "),s=a.pop();la(s,n)<.2*i&&(l[t]=a.join(" "),l[t+1]=s+" "+o),r-=1}}o=l.join("\n")}else o=e;o=oa(o,n),ua[i]=o}return o}const pa=/font-family: ?([^;]*);/,ha=/("|')/g;let da;function fa(e){if(!da){da={};const e=document.styleSheets;for(let t=0,r=e.length;t<r;++t){const r=e[t];try{const e=r.rules||r.cssRules;if(e)for(let t=0,r=e.length;t<r;++t){const r=e[t];if(5==r.type){const e=r.cssText.match(pa);da[e[1].replace(ha,"")]=!0}}}catch(gs){}}}return e in da}const ma={};function ga(e,t="https://cdn.jsdelivr.net/npm/@fontsource/{font-family}/{fontweight}{-fontstyle}.css"){const r=e.toString();if(r in ma)return ma[r];const n=[];for(let i=0,o=e.length;i<o;++i){e[i]=e[i].replace("Arial Unicode MS","Arial");const t=e[i],r=Mo(t,1);ot(r);const o=r.split(" ");n.push([o.slice(3).join(" ").replace(/"/g,""),o[1],o[0]])}for(let i=0,o=n.length;i<o;++i){const e=n[i],r=e[0];if(!fa(r)&&100!==at.get(`${e[2]}\n${e[1]} \n${r}`)){const n=t.replace("{font-family}",r.replace(/ /g,"-").toLowerCase()).replace("{Font+Family}",r.replace(/ /g,"+")).replace("{fontweight}",e[1]).replace("{-fontstyle}",e[2].replace("normal","").replace(/(.+)/,"-$1")).replace("{fontstyle}",e[2]);if(!document.querySelector('link[href="'+n+'"]')){const e=document.createElement("link");e.href=n,e.rel="stylesheet",document.head.appendChild(e)}}}return ma[r]=e,e}const ya={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},xa={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},va=function(e,t){const r=lo(e,t);if("error"===r.result)throw new Error(r.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return r.value},ba={},wa={zoom:0};let Ta,_a;function Sa(e,t,r,n,i,o,a){const s=e.id;o||(o={},console.warn("No functionCache provided to getValue()")),o[s]||(o[s]={});const l=o[s];if(!l[r]){let n=(e[t]||ba)[r];const i=po[`${t}_${e.type}`][r];void 0===n&&(n=i.default);let o=(u=n,Array.isArray(u)&&u.length>0&&"string"==typeof u[0]&&u[0]in eo);if(!o&&no(n)&&(n=wr(n,i),o=!0),o){const e=va(n,i);l[r]=e.evaluate.bind(e)}else"color"==i.type&&(n=vr.parse(n)),l[r]=function(){return n}}var u;return wa.zoom=n,l[r](wa,i,a)}function ka(e,t,r,n){if(!Sa(e,"layout","icon-allow-overlap",t,r,n))return"declutter";return Sa(e,"layout","icon-ignore-placement",t,r,n)?"none":"obstacle"}function za(e,t,r,n,i){return i||console.warn("No filterCache provided to evaluateFilter()"),e in i||(i[e]=fo(t).filter),wa.zoom=n,i[e](wa,r)}let Ca=!1;function Ea(e){e!==Ca&&(!function(){for(const e in Do)delete Do[e]}(),Ca=e)}function Ra(e,t){if(e){if(!Ca&&(0===e.a||0===t))return;const r=e.a;return t=void 0===t?1:t,0===r?"transparent":"rgba("+Math.round(255*e.r/r)+","+Math.round(255*e.g/r)+","+Math.round(255*e.b/r)+","+r*t+")"}return e}const Ia=/\{[^{}}]*\}/g;function ja(e,t){return e.replace(Ia,(function(e){return t[e.slice(1,-1)]||""}))}let Fa=!1;function Ma(e=!1){Fa=e}const Pa={};function Aa(e,t,r,n=Xo,i=void 0,o=void 0,a=void 0,s=void 0){if("string"==typeof t&&(t=JSON.parse(t)),8!=t.version)throw new Error("glStyle version 8 required.");let l,u,c;if(Pa[No(t,e)]=Array.from(arguments),o)if("undefined"!=typeof Image){const t=new Image;let r;Ue((()=>o)).then((e=>{e instanceof Request?fetch(e).then((e=>e.blob())).then((e=>{r=URL.createObjectURL(e),t.src=r})).catch((()=>{})):(t.crossOrigin="anonymous",t.src=e,r&&URL.revokeObjectURL(r))})),t.onload=function(){l=t,u=[t.width,t.height],e.changed(),t.onload=null}}else if("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){const e=self;e.postMessage({action:"loadImage",src:o}),e.addEventListener("message",(function(e){"imageLoaded"===e.data.action&&e.data.src===o&&(l=e.data.image,u=[l.width,l.height])}))}const p=Eo(t.layers),h={},d=[],f={},m={},g=Uo(t),y=Vo(t);let x;for(let _=0,S=p.length;_<S;++_){const e=p[_],n=e.id;if("string"==typeof r&&e.source==r||-1!==r.indexOf(n)){const r=e["source-layer"];if(x){if(e.source!==x)throw new Error(`Layer "${n}" does not use source "${x}`)}else{x=e.source;const r=t.sources[x];if(!r)throw new Error(`Source "${x}" is not defined`);const n=r.type;if("vector"!==n&&"geojson"!==n)throw new Error(`Source "${x}" is not of type "vector" or "geojson", but "${n}"`)}let i=h[r];i||(i=[],h[r]=i),i.push({layer:e,index:_}),d.push(n)}}const v=new Ve,b=new We,w=[],T=function(r,o,p){const d=r.getProperties(),x=h[d.layer];if(!x)return;let T=n.indexOf(o);-1==T&&(T=Ko(o,n));const _=ya[r.getGeometry().getType()],S={id:r.getId(),properties:d,type:_},k=e.get("mapbox-featurestate")[r.getId()];let z,C=-1;for(let n=0,h=x.length;n<h;++n){const h=x[n],E=h.layer,I=E.id;if(void 0!==p&&p!==I)continue;const j=E.layout||ba,F=E.paint||ba;if("none"===j.visibility||"minzoom"in E&&T<E.minzoom||"maxzoom"in E&&T>=E.maxzoom)continue;const M=E.filter;if(!M||za(I,M,S,T,y)){let n,p,y,x,I,M;z=E;const P=h.index;if(3==_&&("fill"==E.type||"fill-extrusion"==E.type))if(p=Sa(E,"paint",E.type+"-opacity",T,S,g,k),E.type+"-pattern"in F){const e=Sa(E,"paint",E.type+"-pattern",T,S,g,k);if(e){const t="string"==typeof e?ja(e,d):e.toString();if(l&&i&&i[t]){++C,M=w[C],M&&M.getFill()&&!M.getStroke()&&!M.getText()||(M=new Ze({fill:new We}),w[C]=M),y=M.getFill(),M.setZIndex(P);const e=t+"."+p;let r=m[e];if(!r){const n=i[t],o=Zo(n.width,n.height),a=o.getContext("2d");a.globalAlpha=p,a.drawImage(l,n.x,n.y,n.width,n.height,0,0,n.width,n.height),r=a.createPattern(o,"repeat"),m[e]=r}y.setColor(r)}}}else n=Ra(Sa(E,"paint",E.type+"-color",T,S,g,k),p),E.type+"-outline-color"in F&&(I=Ra(Sa(E,"paint",E.type+"-outline-color",T,S,g,k),p)),I||(I=n),(n||I)&&(++C,M=w[C],(!M||n&&!M.getFill()||!n&&M.getFill()||I&&!M.getStroke()||!I&&M.getStroke()||M.getText())&&(M=new Ze({fill:n?new We:void 0,stroke:I?new Ve:void 0}),w[C]=M),n&&(y=M.getFill(),y.setColor(n)),I&&(x=M.getStroke(),x.setColor(I),x.setWidth(.5)),M.setZIndex(P));if(1!=_&&"line"==E.type){n=!("line-pattern"in F)&&"line-color"in F?Ra(Sa(E,"paint","line-color",T,S,g,k),Sa(E,"paint","line-opacity",T,S,g,k)):void 0;const e=Sa(E,"paint","line-width",T,S,g,k);n&&e>0&&(++C,M=w[C],M&&M.getStroke()&&!M.getFill()&&!M.getText()||(M=new Ze({stroke:new Ve}),w[C]=M),x=M.getStroke(),x.setLineCap(Sa(E,"layout","line-cap",T,S,g,k)),x.setLineJoin(Sa(E,"layout","line-join",T,S,g,k)),x.setMiterLimit(Sa(E,"layout","line-miter-limit",T,S,g,k)),x.setColor(n),x.setWidth(e),x.setLineDash(F["line-dasharray"]?Sa(E,"paint","line-dasharray",T,S,g,k).map((function(t){return t*e})):null),M.setZIndex(P))}let A,L,O,D,q,$,G,N,U,V=!1,W=null,X=0;if((1==_||2==_)&&"icon-image"in j){const t=Sa(E,"layout","icon-image",T,S,g,k);if(t){let n;A="string"==typeof t?ja(t,d):t.toString();const a=s?s(e,A):void 0;if(l&&i&&i[A]||a){const e=Sa(E,"layout","icon-rotation-alignment",T,S,g,k);if(2==_){const t=r.getGeometry();if(t.getFlatMidpoint||t.getFlatMidpoints){const r=t.getExtent();if(Math.sqrt(Math.max(Math.pow((r[2]-r[0])/o,2),Math.pow((r[3]-r[1])/o,2)))>150){const r="MultiLineString"===t.getType()?t.getFlatMidpoints():t.getFlatMidpoint();_a||(Ta=[NaN,NaN],_a=new R("Point",Ta,[],{},null)),n=_a,Ta[0]=r[0],Ta[1]=r[1];if("line"===Sa(E,"layout","symbol-placement",T,S,g,k)&&"map"===e){const e=t.getStride(),n=t.getFlatCoordinates();for(let t=0,i=n.length-e;t<i;t+=e){const i=n[t],o=n[t+1],a=n[t+e],s=n[t+e+1],l=Math.min(i,a),u=Math.min(o,s),c=Math.max(i,a),p=Math.max(o,s);if(r[0]>=l&&r[0]<=c&&r[1]>=u&&r[1]<=p){X=Math.atan2(o-s,a-i);break}}}}}}if(2!==_||n){const t=Sa(E,"layout","icon-size",T,S,g,k),r=void 0!==F["icon-color"]?Sa(E,"paint","icon-color",T,S,g,k):null;if(!r||0!==r.a){const n=Sa(E,"paint","icon-halo-color",T,S,g,k),o=Sa(E,"paint","icon-halo-width",T,S,g,k);let s=`${A}.${t}.${o}.${n}`;if(null!==r&&(s+=`.${r}`),L=f[s],!L){const p=ka(E,T,S,g);let h;"icon-offset"in j&&(h=Sa(E,"layout","icon-offset",T,S,g,k).slice(0),h[1]*=-1);let d=r?[255*r.r,255*r.g,255*r.b,r.a]:void 0;if(a){const r={color:d,rotateWithView:"map"===e,displacement:h,declutterMode:p,scale:t};"string"==typeof a?r.src=a:(r.img=a,r.imgSize=[a.width,a.height]),L=new Ke(r)}else{const a=i[A];let s,f,m;o?a.sdf?(s=ta(na(l,a,r),{x:0,y:0,width:a.width,height:a.height,pixelRatio:a.pixelRatio},o,n),d=void 0):s=ta(l,a,o,n):(a.sdf?(c||(c=na(l,{x:0,y:0,width:u[0],height:u[1]},{r:1,g:1,b:1,a:1})),s=c):s=l,f=[a.width,a.height],m=[a.x,a.y]),L=new Ke({color:d,img:s,imgSize:u,size:f,offset:m,rotateWithView:"map"===e,scale:t/a.pixelRatio,displacement:h,declutterMode:p})}f[s]=L}}L&&(++C,M=w[C],M&&M.getImage()&&!M.getFill()&&!M.getStroke()||(M=new Ze,w[C]=M),M.setGeometry(n),L.setRotation(X+Wo(Sa(E,"layout","icon-rotate",T,S,g,k))),L.setOpacity(Sa(E,"paint","icon-opacity",T,S,g,k)),L.setAnchor(xa[Sa(E,"layout","icon-anchor",T,S,g,k)]),M.setImage(L),W=M.getText(),M.setText(void 0),M.setZIndex(P),V=!0,O=!1)}else O=!0}}}if(1==_&&"circle"===E.type){++C,M=w[C],M&&M.getImage()&&!M.getFill()&&!M.getStroke()||(M=new Ze,w[C]=M);const e="circle-radius"in F?Sa(E,"paint","circle-radius",T,S,g,k):5,t=Ra(Sa(E,"paint","circle-stroke-color",T,S,g,k),Sa(E,"paint","circle-stroke-opacity",T,S,g,k)),r=Ra(Sa(E,"paint","circle-color",T,S,g,k),Sa(E,"paint","circle-opacity",T,S,g,k)),n=Sa(E,"paint","circle-stroke-width",T,S,g,k),i=e+"."+t+"."+r+"."+n;L=f[i],L||(L=new He({radius:e,stroke:t&&n>0?new Ve({width:n,color:t}):void 0,fill:r?new We({color:r}):void 0,declutterMode:"none"}),f[i]=L),M.setImage(L),W=M.getText(),M.setText(void 0),M.setGeometry(void 0),M.setZIndex(P),V=!0}if("text-field"in j){G=Math.round(Sa(E,"layout","text-size",T,S,g,k));const e=Sa(E,"layout","text-font",T,S,g,k);$=Sa(E,"layout","text-line-height",T,S,g,k),q=Mo(a?a(e,t.metadata?t.metadata["ol:webfonts"]:void 0):e,G,$),q.includes("sans-serif")||(q+=",sans-serif"),N=Sa(E,"layout","text-letter-spacing",T,S,g,k),U=Sa(E,"layout","text-max-width",T,S,g,k);const r=Sa(E,"layout","text-field",T,S,g,k);D="object"==typeof r&&r.sections?1===r.sections.length?r.toString():r.sections.reduce(((t,r,n)=>{const i=r.fontStack?r.fontStack.split(","):e,o=Mo(a?a(i):i,G*(r.scale||1),$);let s=r.text;if("\n"===s)return t.push("\n",""),t;if(2!=_){s=ca(s,o,U,N).split("\n");for(let e=0,r=s.length;e<r;++e)e>0&&t.push("\n",""),t.push(s[e],o);return t}t.push(oa(s,N),o)}),[]):ja(r,d).trim(),p=Sa(E,"paint","text-opacity",T,S,g,k)}if(D&&p&&!O){V||(++C,M=w[C],M&&M.getText()&&!M.getFill()&&!M.getStroke()||(M=new Ze,w[C]=M),M.setImage(void 0),M.setGeometry(void 0)),M.getText()||M.setText(W||new Be({padding:[2,2,2,2]})),W=M.getText();const e=j["text-transform"];"uppercase"==e?D=Array.isArray(D)?D.map(((e,t)=>t%2?e:e.toUpperCase())):D.toUpperCase():"lowercase"==e&&(D=Array.isArray(D)?D.map(((e,t)=>t%2?e:e.toLowerCase())):D.toLowerCase());const t=Array.isArray(D)?D:2==_?oa(D,N):ca(D,q,U,N);W.setText(t),W.setFont(q),W.setRotation(Wo(Sa(E,"layout","text-rotate",T,S,g,k)));const r=Sa(E,"layout","text-anchor",T,S,g,k),n=V||1==_?"point":Sa(E,"layout","symbol-placement",T,S,g,k);let i;if("line-center"===n?(W.setPlacement("line"),i="center"):W.setPlacement(n),"line"===n&&"function"==typeof W.setRepeat){const e=Sa(E,"layout","symbol-spacing",T,S,g,k);W.setRepeat(2*e)}W.setOverflow("point"===n);let o=Sa(E,"paint","text-halo-width",T,S,g,k);const a=Sa(E,"layout","text-offset",T,S,g,k),s=Sa(E,"paint","text-translate",T,S,g,k);let l=0,u=0;if("point"==n){i="center",-1!==r.indexOf("left")?(i="left",u=o):-1!==r.indexOf("right")&&(i="right",u=-o);const e=Sa(E,"layout","text-rotation-alignment",T,S,g,k);W.setRotateWithView("map"==e)}else W.setMaxAngle(Wo(Sa(E,"layout","text-max-angle",T,S,g,k))*D.length/t.length),W.setRotateWithView(!1);W.setTextAlign(i);let c="middle";0==r.indexOf("bottom")?(c="bottom",l=-o-.5*($-1)*G):0==r.indexOf("top")&&(c="top",l=o+.5*($-1)*G),W.setTextBaseline(c);const h=Sa(E,"layout","text-justify",T,S,g,k);W.setJustify("auto"===h?void 0:h),W.setOffsetX(a[0]*G+u+s[0]),W.setOffsetY(a[1]*G+l+s[1]),b.setColor(Ra(Sa(E,"paint","text-color",T,S,g,k),p)),W.setFill(b);const d=Ra(Sa(E,"paint","text-halo-color",T,S,g,k),p);if(d){v.setColor(d),o*=2;const e=.5*G;v.setWidth(o<=e?o:e),W.setStroke(v)}else W.setStroke(void 0);const f=Sa(E,"layout","text-padding",T,S,g,k),m=W.getPadding();f!==m[0]&&(m[0]=f,m[1]=f,m[2]=f,m[3]=f),M.setZIndex(P)}}}return C>-1?(w.length=C+1,Fa&&("set"in r?r.set("mapbox-layer",z):r.getProperties()["mapbox-layer"]=z),w):void 0};return e.setStyle(T),e.set("mapbox-source",x),e.set("mapbox-layers",d),e.set("mapbox-featurestate",e.get("mapbox-featurestate")||{}),T}function La(e,t,r,n){const i=r.getStyleFunction();if(3===i.length)return i(e,t,n)}function Oa(e,t){const r=e[0],n=r.width,i=r.height,o=r.data,a=new Uint8ClampedArray(o.length),s=2*t.resolution,l=n-1,u=i-1,c=[0,0,0,0],p=2*Math.PI,h=Math.PI/2,d=Math.PI*t.sunEl/180,f=Math.PI*t.sunAz/180,m=Math.cos(d),g=Math.sin(d),y=t.highlightColor,x=t.shadowColor,v=t.accentColor,b=t.encoding;let w,T,_,S,k,z,C,E,R,I,j,F,M,P,A,L,O,D,q,$,G,N;function U(e,t="mapbox"){return"mapbox"===t?.1*(256*e[0]*256+256*e[1]+e[2])-1e4:"terrarium"===t?256*e[0]+e[1]+e[2]/256-32768:void 0}for(T=0;T<=u;++T)for(k=0===T?0:T-1,z=T===u?u:T+1,w=0;w<=l;++w)_=0===w?0:w-1,S=w===l?l:w+1,C=4*(T*n+_),c[0]=o[C],c[1]=o[C+1],c[2]=o[C+2],c[3]=o[C+3],E=t.vert*U(c,b),C=4*(T*n+S),c[0]=o[C],c[1]=o[C+1],c[2]=o[C+2],c[3]=o[C+3],R=t.vert*U(c,b),I=(R-E)/s,C=4*(k*n+w),c[0]=o[C],c[1]=o[C+1],c[2]=o[C+2],c[3]=o[C+3],E=t.vert*U(c,b),C=4*(z*n+w),c[0]=o[C],c[1]=o[C+1],c[2]=o[C+2],c[3]=o[C+3],R=t.vert*U(c,b),j=(R-E)/s,M=Math.atan2(j,-I),M=M<0?h-M:M>h?p-M+h:h-M,F=Math.atan(Math.sqrt(I*I+j*j)),N=g*Math.cos(F)+m*Math.sin(F)*Math.cos(f-M),P=Math.cos(F),A=255*N,q=Math.min(Math.max(2*t.sunEl,0),1),$=1.875-1.75*t.opacity,G=.5!==t.opacity?h*((Math.pow($,F)-1)/(Math.pow($,h)-1)):F,O={r:(1-P)*v.r*q*255,g:(1-P)*v.g*q*255,b:(1-P)*v.b*q*255,a:(1-P)*v.a*q*255},L=Math.abs(((M+f)/Math.PI+.5)%2-1),D={r:(y.r*(1-L)+x.r*L)*A,g:(y.g*(1-L)+x.g*L)*A,b:(y.b*(1-L)+x.b*L)*A,a:(y.a*(1-L)+x.a*L)*A},C=4*(T*n+w),a[C]=O.r*(1-L)+D.r,a[C+1]=O.g*(1-L)+D.g,a[C+2]=O.b*(1-L)+D.b,a[C+3]=o[C+3]*t.opacity*q*Math.sin(G);return new ImageData(a,n,i)}function Da(e,t=512){return e.getExtent()?Te({extent:e.getExtent(),tileSize:t,maxZoom:22}).getResolutions():Xo}function qa(e,t){if(!t.accessToken){t=Object.assign({},t);new URL(e).searchParams.forEach(((e,r)=>{t.accessToken=e,t.accessTokenParam=r}))}return t}function $a(e,t,r="",n={},i=void 0){let o,a,s,l,u=!0;return"string"==typeof r||Array.isArray(r)?l=r:(s=r,l=s.source||s.layers,n=s),"string"==typeof n?(o=n,s={}):(o=n.styleUrl,s=n),!1===s.updateSource&&(u=!1),i||(i=s.resolutions),o||"string"!=typeof t||t.trim().startsWith("{")||(o=t),o&&(o=o.startsWith("data:")?location.href:Lo(o,s.accessToken),s=qa(o,s)),new Promise((function(r,n){Yo(t,s).then((function(t){if(8!=t.version)return n(new Error("glStyle version 8 required."));if(!(e instanceof Xe||e instanceof sr))return n(new Error("Can only apply to VectorLayer or VectorTileLayer"));const c=e instanceof sr?"vector":"geojson";if(l?a=Array.isArray(l)?t.layers.find((function(e){return e.id===l[0]})).source:l:(a=Object.keys(t.sources).find((function(e){return t.sources[e].type===c})),l=a),!a)return n(new Error(`No ${c} source found in the glStyle.`));function p(){if(!u)return Promise.resolve();if(e instanceof sr)return Ja(t.sources[a],o,s).then((function(t){const r=e.getSource();if(r?t!==r&&(r.setTileUrlFunction(t.getTileUrlFunction()),"function"==typeof r.setUrls&&"function"==typeof t.getUrls&&r.setUrls(t.getUrls()),r.format_||(r.format_=t.format_),r.getAttributions()||r.setAttributions(t.getAttributions()),r.getTileLoadFunction()===ur&&r.setTileLoadFunction(t.getTileLoadFunction()),H(r.getProjection(),t.getProjection())&&(r.tileGrid=t.getTileGrid())):e.setSource(t),!isFinite(e.getMaxResolution())&&!isFinite(e.getMinZoom())){const t=e.getSource().getTileGrid();e.setMaxResolution(t.getResolution(t.getMinZoom()))}}));const r=t.sources[a];let n=e.getSource();n&&n.get("mapbox-source")===r||(n=Ba(r,o,s));const i=e.getSource();return i?n!==i&&(i.getAttributions()||i.setAttributions(n.getAttributions()),i.format_||(i.format_=n.getFormat()),i.url_=n.getUrl()):e.setSource(n),Promise.resolve()}let h,d,f,m;function g(){if(m||t.sprite&&!d)m?(e.setStyle(m),p().then(r).catch(n)):n(new Error("Something went wrong trying to apply style."));else{if(s.projection&&!i){const e=D(s.projection).getUnits();"m"!==e&&(i=Xo.map((t=>t/Ye[e])))}m=Aa(e,t,l,i,d,f,ga,s.getImage),e.getStyle()?p().then(r).catch(n):n(new Error(`Nothing to show for source [${a}]`))}}if(t.sprite){const e=new URL(function(e,t,r){const n=Ao(e);if(!n)return decodeURI(new URL(e,r).href);const i="sprites/";if(0!==n.indexOf(i))throw new Error(`unexpected sprites url: ${e}`);const o=n.slice(8);return`${Po}/styles/v1/${o}/sprite?access_token=${t}`}(t.sprite,s.accessToken,o||location.href));h=window.devicePixelRatio>=1.5?.5:1;const r=.5==h?"@2x":"";let i=e.origin+e.pathname+r+".json"+e.search;new Promise((function(t,r){Bo("Sprite",i,s).then(t).catch((function(n){i=e.origin+e.pathname+".json"+e.search,Bo("Sprite",i,s).then(t).catch(r)}))})).then((function(t){if(void 0===t&&n(new Error("No sprites found.")),d=t,f=e.origin+e.pathname+r+".png"+e.search,s.transformRequest){const e=s.transformRequest(f,"SpriteImage")||f;(e instanceof Request||e instanceof Promise)&&(f=e)}g()})).catch((function(e){n(new Error(`Sprites cannot be loaded: ${i}: ${e.message}`))}))}else g()})).catch(n)}))}const Ga={};function Na(e,t,r={}){return Yo(t,r).then((function(t){!function(e,t,r){t.layers.some((function(t){if("background"===t.type){if(e instanceof h)return e.setBackground((function(e){return Wa(t,e,r,{})})),!0;if(e instanceof Je||e instanceof Qe)return e.getLayers().push(Xa(t,r,{})),!0}}))}(e,t,r)}))}function Ua(e,t){let r;return e.some((function(e){if(e.id==t)return r=e.source,!0})),r}function Va(e,t,r){const n=new nr({tileJSON:t,tileSize:e.tileSize||t.tileSize||512}),i=n.getTileJSON(),o=n.getTileGrid(),a=D(r.projection||"EPSG:3857"),s=function(e,t){const r=e.bounds;if(r){const e=it([r[0],r[1]],t),n=it([r[2],r[3]],t);return[e[0],e[1],n[0],n[1]]}return D(t).getExtent()}(i,a),l=a.getExtent(),u=i.minzoom||0,c=i.maxzoom||22,p={attributions:n.getAttributions(),projection:a,tileGrid:new qe({origin:l?le(l):o.getOrigin(0),extent:s||o.getExtent(),minZoom:u,resolutions:Da(a,t.tileSize).slice(0,c+1),tileSize:o.getTileSize(0)})};return Array.isArray(i.tiles)?p.urls=i.tiles:p.url=i.tiles,p}function Wa(e,t,r,n){const i={id:e.id,type:e.type},o=e.layout||{},a=e.paint||{};i.paint=a;const s=Ko(t,r.resolutions||Xo);let l,u;return void 0!==a["background-color"]&&(l=Sa(i,"paint","background-color",s,Ga,n)),void 0!==a["background-opacity"]&&(u=Sa(i,"paint","background-opacity",s,Ga,n)),"none"==o.visibility?void 0:Ra(l,u)}function Xa(e,t,r){const n=document.createElement("div");return n.className="ol-mapbox-style-background",n.style.position="absolute",n.style.width="100%",n.style.height="100%",new h({source:new Z({}),render(i){const o=Wa(e,i.viewState.resolution,t,r);return n.style.backgroundColor=o,n}})}function Ja(e,t,r){return new Promise((function(n,i){ea(e,t,r).then((function({tileJson:t,tileLoadFunction:i}){const o=Va(e,t,r);o.tileLoadFunction=i,o.format=new Tt,n(new lr(o))})).catch(i)}))}function Za(e){return`{bbox-${(e?e.getCode():"EPSG:3857").toLowerCase().replace(/[^a-z0-9]/g,"-")}}`}function Ka(e,t,r){return new Promise((function(n,i){ea(e,t,r).then((function({tileJson:t,tileLoadFunction:i}){const o=new nr({interpolate:void 0===r.interpolate||r.interpolate,transition:0,crossOrigin:"anonymous",tileJSON:t});o.tileGrid=Va(e,t,r).tileGrid,r.projection&&(o.projection=D(r.projection));const a=o.getTileUrlFunction();i&&o.setTileLoadFunction(i),o.setTileUrlFunction((function(e,t,r){const n=Za(r);let i=a(e,t,r);if(-1!=i.indexOf(n)){const t=o.getTileGrid().getTileCoordExtent(e);i=i.replace(n,t.toString())}return i})),o.set("mapbox-source",e),n(o)})).catch((function(e){i(e)}))}))}function Ha(e,t,r){const n=new Pt;return Ka(e,t,r).then((function(e){n.setSource(e)})).catch((function(){n.setSource(void 0)})),n}function Ba(e,t,r){const n=r.projection?new et({dataProjection:r.projection}):new et,i=e.data,o={};if("string"==typeof i){const o=Oo(i,r.accessToken,r.accessTokenParam||"access_token",t||location.href);if(/\{bbox-[0-9a-z-]+\}/.test(o)){const t=(e,t,r)=>{const n=Za(r);return o.replace(n,`${e.join(",")}`)},i=new tt({attributions:e.attribution,format:n,loader:(e,n,o,a,s)=>{Bo("GeoJSON","function"==typeof t?t(e,n,o):t,r).then((e=>{const t=i.getFormat().readFeatures(e,{featureProjection:o});i.addFeatures(t),a(t)})).catch((t=>{i.removeLoadedExtent(e),s()}))},strategy:rt});return i.set("mapbox-source",e),i}const a=new tt({attributions:e.attribution,format:n,url:o,loader:(e,t,n,i,s)=>{Bo("GeoJSON",o,r).then((e=>{const t=a.getFormat().readFeatures(e,{featureProjection:n});a.addFeatures(t),i(t)})).catch((t=>{a.removeLoadedExtent(e),s()}))}});return a}o.features=n.readFeatures(i,{featureProjection:"EPSG:3857"});const a=new tt(Object.assign({attributions:e.attribution,format:n},o));return a.set("mapbox-source",e),a}function Ya(e,t,r){let n=null;return function(i){e.paint&&"raster-opacity"in e.paint&&i.frameState.viewState.zoom!==n&&(n=i.frameState.viewState.zoom,delete r[e.id],function(e,t,r,n){const i=Sa(e,"paint","raster-opacity",r,Ga,n);t.setOpacity(i)}(e,t,n,r))}}function Qa(e,t,r,n){const i=Uo(e),o=e.layers,a=r.type,s=r.source||Ua(o,r.ref),l=e.sources[s];let u;if("background"==a)u=Xa(r,n,i);else if("vector"==l.type)u=function(e,t,r){const n=new sr({declutter:!0,visible:!1});return Ja(e,t,r).then((function(t){t.set("mapbox-source",e),n.setSource(t)})).catch((function(e){n.setSource(void 0)})),n}(l,t,n);else if("raster"==l.type)u=Ha(l,t,n),u.setVisible(!r.layout||"none"!==r.layout.visibility),u.on("prerender",Ya(r,u,i));else if("geojson"==l.type)u=function(e,t,r){return new Xe({declutter:!0,source:Ba(e,t,r),visible:!1})}(l,t,n);else if("raster-dem"==l.type&&"hillshade"==r.type){const e=function(e,t,r){const n=Ha(e,t,r);return new yt({source:new Kt({operationType:"image",operation:Oa,sources:[n]})})}(l,t,n);u=e,e.getSource().on("beforeoperations",(function(e){const t=e.data;t.resolution=e.resolution;const o=Ko(e.resolution,n.resolutions||Xo);t.encoding=l.encoding,t.vert=5*Sa(r,"paint","hillshade-exaggeration",o,Ga,i),t.sunAz=Sa(r,"paint","hillshade-illumination-direction",o,Ga,i),t.sunEl=35,t.opacity=.3,t.highlightColor=Sa(r,"paint","hillshade-highlight-color",o,Ga,i),t.shadowColor=Sa(r,"paint","hillshade-shadow-color",o,Ga,i),t.accentColor=Sa(r,"paint","hillshade-accent-color",o,Ga,i)})),u.setVisible(!r.layout||"none"!==r.layout.visibility)}const c=s;return u&&u.set("mapbox-source",c),u}function es(e,t,r,n){const i=[];let o=null;if(t instanceof Je){if(o=t.getView(),!o.isDef()&&!o.getRotation()&&!o.getResolutions()){const e=n.projection?D(n.projection):o.getProjection();o=new nt(Object.assign(o.getProperties(),{maxResolution:Xo[0]/Ye[e.getUnits()],projection:n.projection||o.getProjection()})),t.setView(o)}"center"in e&&!o.getCenter()&&o.setCenter(it(e.center,o.getProjection())),"zoom"in e&&void 0===o.getZoom()&&o.setResolution(Xo[0]/Ye[o.getProjection().getUnits()]/Math.pow(2,e.zoom)),o.getCenter()&&void 0!==o.getZoom()||o.fit(o.getProjection().getExtent(),{nearest:!0,size:t.getSize()})}t.set("mapbox-style",e),t.set("mapbox-metadata",{styleUrl:r,options:n});const a=e.layers;let s,l,u,c=[];for(let p=0,h=a.length;p<h;++p){const o=a[p],h=o.type;if("heatmap"==h)throw new Error(`${h} layers are not supported`);u=o.source||Ua(a,o.ref),u&&u==l||(c.length&&(i.push(rs(s,c,e,r,t,n)),c=[]),s=Qa(e,r,o,n),s instanceof Xe||s instanceof sr||(c=[]),l=s.get("mapbox-source")),c.push(o.id)}return i.push(rs(s,c,e,r,t,n)),Promise.all(i)}function ts(e,t,r={}){let n,i;if(i="string"==typeof e||e instanceof HTMLElement?new Je({target:e}):e,"string"==typeof t){const e=t.startsWith("data:")?location.href:Lo(t,r.accessToken);r=qa(e,r),n=new Promise((function(n,o){Yo(t,r).then((function(t){es(t,i,e,r).then((function(){n(i)})).catch(o)})).catch((function(e){o(new Error(`Could not load ${t}: ${e.message}`))}))}))}else n=new Promise((function(e,n){es(t,i,!r.styleUrl||r.styleUrl.startsWith("data:")?location.href:Lo(r.styleUrl,r.accessToken),r).then((function(){e(i)})).catch(n)}));return n}function rs(e,t,r,n,i,o={}){let a=24,s=0;const l=r.layers;for(let u=0,c=l.length;u<c;++u){const e=l[u];-1!==t.indexOf(e.id)&&(a=Math.min("minzoom"in e?e.minzoom:0,a),s=Math.max("maxzoom"in e?e.maxzoom:24,s))}return new Promise((function(l,u){const c=function(){const c=e.getSource();if(c&&"error"!==c.getState()){if("getTileGrid"in c){const t=c.getTileGrid();if(t){const r=t.getMinZoom();(a>0||r>0)&&e.setMaxResolution(Math.min(Jo.getResolution(a),t.getResolution(r))+1e-9),s<24&&e.setMinResolution(Jo.getResolution(s)+1e-9)}}else a>0&&e.setMaxResolution(Jo.getResolution(a)+1e-9);c instanceof tt||c instanceof lr?$a(e,r,t,Object.assign({styleUrl:n},o)).then((function(){!function(e,t){function r(){const r=t.get("mapbox-style");if(!r)return;const n=Eo(r.layers),i=e.get("mapbox-layers"),o=n.filter((function(e){return i.includes(e.id)})).some((function(e){return!e.layout||!e.layout.visibility||"visible"===e.layout.visibility}));e.get("visible")!==o&&e.setVisible(o)}e.on("change",r),r()}(e,i),l()})).catch(u):l()}else u(new Error("Error accessing data for source "+e.get("mapbox-source")))};e.set("mapbox-layers",t);const p=i.getLayers();-1===p.getArray().indexOf(e)&&p.push(e),e.getSource()?c():e.once("change:source",c)}))}function ns(e,t){return e.get("mapbox-style").layers.find((function(e){return e.id===t}))}function is(e,t,r){const n=e.get("mapbox-style"),i=n.layers;let o,a,s=-1;if(void 0!==r){const t=ns(e,r);if(void 0===t)throw new Error(`Layer with id "${r}" not found.`);o=i.indexOf(t)}else o=i.length;if(o>0&&i[o-1].source===t.source?(s=o-1,a=-1):o<i.length&&i[o].source===t.source&&(s=o,a=0),-1===s){const{options:a,styleUrl:s}=e.get("mapbox-metadata"),l=Qa(n,s,t,a);if(r){const t=ls(e,r),n=e.getLayers().getArray().indexOf(t);e.getLayers().insertAt(n,l)}return i.splice(o,0,t),rs(l,[t.id],n,s,e,a)}if(i.some((e=>e.id===t.id)))throw new Error(`Layer with id "${t.id}" already exists.`);const l=i[s].id,u=Pa[No(e.get("mapbox-style"),ls(e,l))];if(i.splice(o,0,t),u){const[e,r,n,i,o,s,c,p]=u;if(Array.isArray(n)){const e=n.indexOf(l)+a;n.splice(e,0,t.id)}Aa(e,r,n,i,o,s,c,p)}else ls(e,i[s].id).changed();return Promise.resolve()}function os(e,t){const r=e.get("mapbox-style"),n=r.layers,i=n.findIndex((function(e){return e.id===t.id}));if(-1===i)throw new Error(`Layer with id "${t.id}" not found.`);if(n[i].source!==t.source)throw new Error("Updated layer and previous version must use the same source.");delete Uo(r)[t.id],delete Vo(r)[t.id],n[i]=t;const o=Pa[No(e.get("mapbox-style"),ls(e,t.id))];o?Aa.apply(void 0,o):ls(e,t.id).changed()}function as(e,t,r){const n=cs(e,t),i=e.getLayers().getArray().filter((function(e){return(e instanceof Xe||e instanceof Pt||e instanceof sr)&&e.getSource()===n})),o=e.get("mapbox-metadata");let a;switch(r.type){case"vector":a=Ja(r,o.styleUrl,o.options);break;case"geojson":a=Promise.resolve(Ba(r,o.styleUrl,o.options));break;case"raster":case"raster-dem":a=Ka(r,o.styleUrl,o.options);break;default:return Promise.reject(new Error("Unsupported source type "+r.type))}return a.then((function(e){i.forEach((function(t){t.setSource(e)}))})),a}function ss(e,t){const r="string"==typeof t?t:t.id,n=ls(e,r),i=n.get("mapbox-layers");if(1===i.length)throw new Error("Cannot remove last Mapbox layer from an OpenLayers layer.");i.splice(i.indexOf(r),1);const o=e.get("mapbox-style"),a=o.layers;a.splice(a.findIndex((e=>e.id===r)),1);const s=Pa[No(o,n)];if(s){const[e,t,n,i,o,a,l,u]=s;Array.isArray(n)&&n.splice(n.findIndex((e=>e===r)),1),Aa(e,t,n,i,o,a,l,u)}else ls(e,r).changed()}function ls(e,t){const r=e.getLayers().getArray();for(let n=0,i=r.length;n<i;++n){const e=r[n].get("mapbox-layers");if(e&&-1!==e.indexOf(t))return r[n]}}function us(e,t){const r=[],n=e.getLayers().getArray();for(let i=0,o=n.length;i<o;++i)n[i].get("mapbox-source")===t&&r.push(n[i]);return r}function cs(e,t){const r=e.getLayers().getArray();for(let n=0,i=r.length;n<i;++n){const e=r[n].getSource();if(r[n].get("mapbox-source")===t)return e}}function ps(e,t,r){const n="getLayers"in e?us(e,t.source):[e];for(let i=0,o=n.length;i<o;++i){const e=n[i].get("mapbox-featurestate");if(!e)throw new Error(`Map or layer for source "${t.source}" not found.`);r?e[t.id]=r:delete e[t.id],n[i].changed()}}function hs(e,t){const r="getLayers"in e?us(e,t.source):[e];for(let n=0,i=r.length;n<i;++n){const e=r[n].get("mapbox-featurestate");if(e&&e[t.id])return e[t.id]}}class ds extends ee{constructor(e){super(W.ERROR),this.error=e}}class fs extends sr{constructor(e){const t=!("declutter"in e)||e.declutter,r=new lr({state:"loading",format:new Tt});super({source:r,background:e.background,declutter:t,className:e.className,opacity:e.opacity,visible:e.visible,zIndex:e.zIndex,minResolution:e.minResolution,maxResolution:e.maxResolution,minZoom:e.minZoom,maxZoom:e.maxZoom,renderOrder:e.renderOrder,renderBuffer:e.renderBuffer,renderMode:e.renderMode,map:e.map,updateWhileAnimating:e.updateWhileAnimating,updateWhileInteracting:e.updateWhileInteracting,preload:e.preload,useInterimTilesOnError:e.useInterimTilesOnError,properties:e.properties}),e.accessToken&&(this.accessToken=e.accessToken);const n=[$a(this,e.styleUrl,e.layers||e.source,{accessToken:this.accessToken})];void 0===this.getBackground()&&n.push(Na(this,e.styleUrl,{accessToken:this.accessToken})),Promise.all(n).then((()=>{r.setState("ready")})).catch((e=>{this.dispatchEvent(new ds(e));this.getSource().setState("error")}))}}export{fs as MapboxVectorLayer,is as addMapboxLayer,ts as apply,Na as applyBackground,$a as applyStyle,ts as default,hs as getFeatureState,ls as getLayer,us as getLayers,ns as getMapboxLayer,cs as getSource,La as getStyleForLayer,Ma as recordStyleLayer,ss as removeMapboxLayer,Ea as renderTransparent,ps as setFeatureState,Aa as stylefunction,os as updateMapboxLayer,as as updateMapboxSource};
